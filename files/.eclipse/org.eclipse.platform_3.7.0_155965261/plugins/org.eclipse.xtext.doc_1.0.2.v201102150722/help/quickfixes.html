<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Quick Fixes</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
<link rel="home" href="index.html" title="Xtext User Guide">
<link rel="up" href="IDEConcepts.html" title="IDE Concepts">
<link rel="prev" href="contentAssist.html" title="Content Assist">
<link rel="next" href="templates.html" title="Template Proposals">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">Quick Fixes</h1>
<p>For validations written using the 
				<a class="link" href="validation.html#custom_validation" title="Custom Validation">AbstractDeclarativeValidator</a> 
				it is possible to provide corresponding quick fixes in the editor. To be able to implement a quick fix 
				for a given diagnostic (a warning or error) the underlying 
				<span class="emphasis"><em>cause</em></span> of the diagnostic must be known 
				(i.e. what actual problem does the diagnostic represent?), otherwise the fix doesn&rsquo;t know what needs 
				to be done. As we don&rsquo;t want to deduce this from the diagnostic&rsquo;s error message we associate a problem 
				specific 
				<span class="emphasis"><em>code</em></span> with the diagnostic.
			</p>
<p>In the following example taken from the 
				<span class="emphasis"><em>DomainmodelJavaValidator</em></span> 
				the diagnostic&rsquo;s 
				<span class="emphasis"><em>code</em></span> is given by the third argument to the 
				<span class="emphasis"><em>warning()</em></span> method and it is a reference 
				to the static 
				<span class="emphasis"><em>String</em></span> field _==INVALID_TYPE_NAME==_ in the validator class.
			</p>
<div class="literallayout">
<p>
<code class="code">warning("Name&nbsp;should&nbsp;start&nbsp;with&nbsp;a&nbsp;capital",&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;DomainmodelPackage.TYPE__NAME,&nbsp;INVALID_TYPE_NAME,&nbsp;type.getName());<br>

<br>

</code>
</p>
</div>
<p>Now that the validation has a unique code identifying the problem we can register quick fixes for it. 
				We start by adding the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.generator/src/org/eclipse/xtext/ui/generator/quickfix/QuickfixProviderFragment.java?root=Modeling_Project&view=co" target="_new">QuickfixProviderFragment</a> 
				to our workflow and after regenerating the code we should find an empty class 
				<span class="emphasis"><em>MyDslQuickfixProvider</em></span> 
				in our DSL&rsquo;s UI project and new entries in the _==plugin.xml_gen==_ file.
			</p>
<p>Continuing with the _==INVALID_TYPE_NAME==_ problem from the Domainmodel example we add a method with which 
				the problem can be fixed (have a look at the 
				<span class="emphasis"><em>DomainmodelQuickfixProvider</em></span> for details):
			</p>
<div class="literallayout">
<p>
<code class="code">@Fix(DomainmodelJavaValidator.INVALID_TYPE_NAME)<br>
public&nbsp;void&nbsp;fixName(final&nbsp;Issue&nbsp;issue,&nbsp;IssueResolutionAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;acceptor.accept(issue,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Capitalize&nbsp;name",&nbsp;//&nbsp;quick&nbsp;fix&nbsp;label<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Capitalize&nbsp;name&nbsp;&nbsp;of&nbsp;'"&nbsp;+&nbsp;issue.getData()[0]&nbsp;+&nbsp;"'",&nbsp;&nbsp;//&nbsp;description&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"upcase.png",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;quick&nbsp;fix&nbsp;icon<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;IModification()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;apply(IModificationContext&nbsp;context)&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;BadLocationException&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IXtextDocument&nbsp;xtextDocument&nbsp;=&nbsp;context.getXtextDocument();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;firstLetter&nbsp;=&nbsp;xtextDocument.get(issue.getOffset(),&nbsp;1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xtextDocument.replace(issue.getOffset(),&nbsp;1,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Strings.toFirstUpper(firstLetter));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;);<br>
}<br>

<br>

</code>
</p>
</div>
<p>By using the correct signature (see below) and annotating the method with the 
				<span class="emphasis"><em>@Fix</em></span> annotation 
				referencing the previously specified issue code from the validator, Xtext knows that this method 
				implements a fix for the problem. This also allows us to annotate multiple methods as fixes for the 
				same problem.
			</p>
<p>The first three parameters given to the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/quickfix/IssueResolutionAcceptor.java?root=Modeling_Project&view=co" target="_new">IssueResolutionAcceptor</a> define the 
				UI representation of the quick fix. As the document is not necessarily loaded when the quick fix is 
				offered, we need to provide any additional data from the model that we want to refer to in the UI 
				when creating the issue in the validator above. In this case, we provided the existing type name. 
				The additional data is available as 
				<span class="emphasis"><em>Issue.getData()</em></span>. As it is persisted in markers, only strings 
				are allowed. 
			</p>
<p>The actual model modification is implemented in the 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IModification.java?root=Modeling_Project&view=co" target="_new">IModification</a>. 
				The 
				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/IModificationContext.java?root=Modeling_Project&view=co" target="_new">IModificationContext</a> provides 
				access to the erroneous document. In this case, we&rsquo;re using Eclipse&rsquo;s 
				<span class="emphasis"><em>IDocument</em></span> API to replace a 
				text region.    
			</p>
<p>If you prefer to implement the quick fix in terms of the semantic model use a 

				<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/model/edit/ISemanticModification.java?root=Modeling_Project&view=co" target="_new">ISemanticModification</a> instead. 
				Its 
				<span class="emphasis"><em>apply(EObject, IModificationContext)</em></span> method will be invoked inside a modify-transaction and the 
				first argument will be the erroneous semantic element. This makes it very easy for the fix method to 
				modify the model as necessary. After the method returns the model as well as the Xtext editor&rsquo;s content 
				will be updated accordingly. If the method fails (throws an exception) the change will not be committed. 
				The following snippet shows a semantic quick fix for a similar problem.
			</p>
<div class="literallayout">
<p>
<code class="code">@Fix(DomainmodelJavaValidator.INVALID_FEATURE_NAME)<br>
public&nbsp;void&nbsp;fixFeatureName(final&nbsp;Issue&nbsp;issue,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IssueResolutionAcceptor&nbsp;acceptor)&nbsp;{<br>
&nbsp;&nbsp;acceptor.accept(issue,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Uncapitalize&nbsp;name",&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;label<br>
&nbsp;&nbsp;&nbsp;&nbsp;"Uncapitalize&nbsp;name&nbsp;of&nbsp;'"&nbsp;+&nbsp;issue.getData()[0]&nbsp;+&nbsp;"'",&nbsp;//&nbsp;description<br>
&nbsp;&nbsp;&nbsp;&nbsp;"upcase.png",&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;icon&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;ISemanticModification()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;apply(EObject&nbsp;element,&nbsp;IModificationContext&nbsp;context)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((Feature)&nbsp;element).setName(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Strings.toFirstLower(issue.getData()[0]));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;);<br>
}<br>

<br>

</code>
</p>
</div>
<div class="section" title="Quickfixes for Linking Errors and Syntax Errors">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="QuickfixesforLinkingErrorsandSyntaxErrors"></a>Quickfixes for Linking Errors and Syntax Errors</h3>
</div>
</div>
</div>
<p>You can even define quick fixes for linking errors. The issue codes are assigned by the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/linking/ILinkingDiagnosticMessageProvider.java?root=Modeling_Project&view=co" target="_new">ILinkingDiagnosticMessageProvider</a>. Have a look at the domain model example how to add quick fixes for these errors.
				</p>
<p>Analogously, there is the 
					<a class="ulink" href="http://dev.eclipse.org/viewcvs/index.cgi/org.eclipse.tmf/org.eclipse.xtext/plugins/org.eclipse.xtext/src/org/eclipse/xtext/parser/antlr/ISyntaxErrorMessageProvider.java?root=Modeling_Project&view=co" target="_new">ISyntaxErrorMessageProvider</a> to assign issue codes to syntactical errors.
				</p>
</div>
</body>
</html>
