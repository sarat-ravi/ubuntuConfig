<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Migrating Step By Step</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
<link rel="home" href="index.html" title="Xtext User Guide">
<link rel="up" href="migrating_from_0_7.html" title="Migrating from Xtext 0.7.x to 1.0">
<link rel="prev" href="migrating_from_0_7.html" title="Migrating from Xtext 0.7.x to 1.0">
<link rel="next" href="NowGoForTheNewFeatures.html" title="Now Go For The New Features">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<h1 xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0">Migrating Step By Step</h1>
<p>Before you start the migration to Xtext 1.0, you should make sure that no old plug-ins are in your target platform. Some plug-ins from Xtext 0.7.x have been merged and 
				do no longer exist. </p>
<p>
				
<span class="emphasis"><em>Tip: The following steps try to use the Eclipse compiler to spot any source-incompatible changes while fixing them with only a few well described user actions. Doing these steps in another order causes most likely a higher effort.</em></span>
			
</p>
<div class="section" title="Update the Plug-in Dependencies and Import Statements">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UpdatethePluginDependenciesandImportStatements"></a>Update the Plug-in Dependencies and Import Statements</h3>
</div>
</div>
</div>
<p>You should update the constraints from version 
					<span class="emphasis"><em>0.7.x</em></span> to 
					<span class="emphasis"><em>[1.0.0,2.0.0)</em></span> in your manifest files if you specified any concrete versions.
					Make sure that your 
					<span class="emphasis"><em>dsl.ui</em></span>-projects do not refer to the plug-in 
					<span class="emphasis"><em>org.eclipse.xtext.ui.common</em></span> or 
					<span class="emphasis"><em>org.eclipse.xtext.ui.core</em></span> but to 
					<span class="emphasis"><em>org.eclipse.xtext.ui</em></span> instead. The arguably easiest way is a global text-based search and replace across the manifest files. The bundle 
					<span class="emphasis"><em>org.eclipse.xtext.log4j</em></span> is obsolete as well. The generator will create 
					<span class="emphasis"><em>import-package</em></span> entries in the manifests later on.
				</p>
<p>The next step is to fix the import statements in your classes to match the refactored naming scheme in Xtext. Perform a global search for "
					<span class="emphasis"><em>import org.eclipse.xtext.ui.common.</em></span>" and 
					"
					<span class="emphasis"><em>import org.eclipse.xtext.ui.core.</em></span>" and replace the matches with "
					<span class="emphasis"><em>import org.eclipse.xtext.ui.</em></span>". This fixes most of the problems in the manually written code. 
				</p>
</div>
<div class="section" title="Rename the Packages in the dsl.ui-Plug-in">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RenamethePackagesinthedsl.uiPlugin"></a>Rename the Packages in the dsl.ui-Plug-in</h3>
</div>
</div>
</div>
<p>We changed the naming pattern for artifacts in the 
					<span class="emphasis"><em>dsl.ui</em></span>-plug-in to match the OSGI conventions. The easiest way to update your existing projects is to apply a 
					&ldquo;Rename Package&rdquo; refactoring on the packages in the 
					<span class="emphasis"><em>src</em></span>- and 
					<span class="emphasis"><em>src-gen</em></span> folder 
					<span class="bold"><strong>before</strong></span> you re-run the workflow that regenerates your language. Make sure you ticked &ldquo;Rename sub-packages&rdquo; in the dialog. It is error-prone to enable the search in non-Java files as this will perform incompatible changes in the manifest files. Furthermore, it is important to perform the rename operation in the 
					<span class="emphasis"><em>src-gen</em></span> folder, too. This ensures that the references in your manually written code are properly updated.
				</p>
</div>
<div class="section" title="Update the Workflow">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UpdatetheWorkflow"></a>Update the Workflow</h3>
</div>
</div>
</div>
<p>The 
					<span class="emphasis"><em>JavaScopingFragment</em></span> does no longer exist. It has been superseded by the 
					<span class="emphasis"><em>ImportURIScopingFragment</em></span> in combination with the 
					<span class="emphasis"><em>SimpleNamesFragment</em></span>.
					Please replace  
				</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.eclipse.xtext.generator.scoping.JavaScopingFragment"/&gt;<br>

</code>
</p>
</div>
<p>with</p>
<div class="literallayout">
<p>
<code class="code">&lt;fragment&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.eclipse.xtext.generator.scoping.ImportURIScopingFragment"/&gt;<br>
&lt;fragment&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;class="org.eclipse.xtext.generator.exporting.SimpleNamesFragment"/&gt;<br>

</code>
</p>
</div>
<p>The 
					<span class="emphasis"><em>PackratParserFragment</em></span> has been abandoned as well. It is save to remove the reference to that one if it is activated in your workflow. After you&rsquo;ve changed your workflow, it should be possible to regenerate your language without any errors in the console. It is ok to have compilation errors prior to executing the workflow.
				</p>
</div>
<div class="section" title="MANIFEST.MF and plugin.xml">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="MANIFEST.MFandplugin.xml"></a>MANIFEST.MF and plugin.xml</h3>
</div>
</div>
</div>
<p>The previous rename package refactoring updated most of the entries in the 
					<span class="emphasis"><em>MANIFEST.MF</em></span> and and some entries in the 
					<span class="emphasis"><em>plugin.xml</em></span>. Others have to be fixed manually. The Eclipse compiler will point to many of the remaining problems in the manifest files but it is unlikely that it will spot the erroneous references in the 
					<span class="emphasis"><em>plugin.xml</em></span>.
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>In the generated UI plug-in&rsquo;s 
							<span class="emphasis"><em>MANIFEST.MF</em></span>, remove the package exports of no longer existing packages and make sure the bundle activator points to the newly generated one (with 
							<span class="emphasis"><em>.ui.</em></span> in its package name).  
						</p>
</li>
<li class="listitem">
<p>It was already mentioned that the plug-ins 
							<span class="emphasis"><em>org.eclipse.xtext.ui.core</em></span> and 
							<span class="emphasis"><em>org.eclipse.xtext.ui.common</em></span> have been merged into a new single plug-in 
							<span class="emphasis"><em>org.eclipse.xtext.ui</em></span>. The same happened to the respective Java packages. Change eventually remaining bundle-dependencies in all manifests. 
						</p>
</li>
<li class="listitem">
<p>The plug-in 
							<span class="emphasis"><em>org.eclipse.xtext.log4j</em></span> no longer exists. We use a package import of 
							<span class="emphasis"><em>org.apache.log4j</em></span> instead. Also remove the buddy registration. 
						</p>
</li>
<li class="listitem">
<p>Due to renamed packages, you have to fix all references to classes therein in the 
							<span class="emphasis"><em>plugin.xml</em></span>. A diff with the _plugin.xml___gen_ will be a great help. If you haven&rsquo;t added a lot manually, consider merging these into the generated version instead of going the other way around. Note that warnings in the 
							<span class="emphasis"><em>plugin.xml</em></span> can be considered to be real errors most of the time. Make sure
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>the 
									<span class="emphasis"><em>ExecutableExtensionFactory</em></span> has the 
									<span class="emphasis"><em>.ui.</em></span> package prefix
								</p>
</li>
<li class="listitem">
<p>classes from 
									<span class="emphasis"><em>org.eclipse.xtext.ui.common</em></span> and 
									<span class="emphasis"><em>org.eclipse.xtext.ui.core</em></span> are now usually somewhere in 
									<span class="emphasis"><em>org.eclipse.xtext.ui</em></span>. They are also referenced by the 
									<span class="emphasis"><em>ExecutableExtensionFactory</em></span> and thus not covered by the editor&rsquo;s validation. 
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>A number of new features are being registered in the 
							<span class="emphasis"><em>plugin.xml</em></span>, e.g. 
							<span class="emphasis"><em>Find references</em></span>, 
							<span class="emphasis"><em>Quick Outline</em></span>, and 
							<span class="emphasis"><em>Quick Fixes</em></span>. You can enable them by manually copying the respective entries from _plugin.xml___gen_ to  
							<span class="emphasis"><em>plugin.xml</em></span>.
						</p>
</li>
<li class="listitem">
<p>To run MWE2 workflows later on, you must change the plug-in dependencies from 
							<span class="emphasis"><em>org.eclipse.emf.mwe.core</em></span> to 
							<span class="emphasis"><em>org.eclipse.emf.mwe2.launch</em></span> in your manifest. Optional resolution is fine.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Noteworthy API Changes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="NoteworthyAPIChanges"></a>Noteworthy API Changes </h3>
</div>
</div>
</div>
<p>The 
					<span class="emphasis"><em>src</em></span> folders are generated once, so existing code will not be overwritten but has to be updated manually. At least one new class has appeared in your 
					<span class="emphasis"><em>src</em></span>-folder of the 
					<span class="emphasis"><em>ui</em></span> plug-in. there will now be a 
					<span class="emphasis"><em>StandaloneSetup</em></span> inheriting form the generated 
					<span class="emphasis"><em>StandaloneSetupGenerated</em></span> to allow customization.
				</p>
<p>You will face a couple of compilation problems due to changes in the API. Here&rsquo;s a list of the most prominent changes. It is usually only necessary to change your code, if you face any compilation problems.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>The method 
							<span class="emphasis"><em>IScopeProvider.getScope(EObject,EClass)</em></span> has been removed. Use  
							<span class="emphasis"><em>IScopeProvider.getScope(EObject,EReference)</em></span> instead. 
						</p>
</li>
<li class="listitem">
<p>Renamed 
							<span class="emphasis"><em>DefaultScopeProvider</em></span> to 
							<span class="emphasis"><em>SimpleNameScopeProvider</em></span>. There have been further significant changes in the scoping API that allow for optimized implementations. Consult the 
							<a class="link" href="scoping.html" title="Scoping">section on scoping</a> for details.
						</p>
</li>
<li class="listitem">
<p>The return type of 
							<span class="emphasis"><em>AbstractInjectableValidator.getEPackages()</em></span> was changed from 
							<span class="emphasis"><em>List&lt;? extends EPackage&gt;</em></span> to 
							<span class="emphasis"><em>List&amp;lt;EPackage&gt;</em></span>.
						</p>
</li>
<li class="listitem">
<p>The parser interfaces now use 
							<span class="emphasis"><em>java.io.Reader</em></span> instead of 
							<span class="emphasis"><em>java.io.InputStream</em></span> to explicitly address encoding. Have a look at the 
							<a class="link" href="encoding.html" title="Encoding in Xtext">section on encoding</a> for details.
						</p>
</li>
<li class="listitem">
<p>The handling of 
							<span class="emphasis"><em>ILabelProvider</em></span> in various contexts has been refactored. The former base class 
							<span class="emphasis"><em>DefaultLabelProvider</em></span> no longer exists. Use the 
							<span class="emphasis"><em>DefaultEObjectLabelProvider</em></span> instead. See the 
							<a class="link" href="IDEConcepts.html#labelProvider" title="Label Provider">section on label providers</a> for details. 
						</p>
</li>
<li class="listitem">
<p>We have introduced a couple of new packages to better separate concerns. Most classes should be easy to relocate. </p>
</li>
<li class="listitem">
<p>The runtime and UI modules have separate base classes 
							<span class="emphasis"><em>DefaultRuntimeModule</em></span> and 
							<span class="emphasis"><em>DefaultUiModule</em></span> now. We use Guice&rsquo;s module overrides to combine them with the newly introduced 
							<span class="emphasis"><em>SharedModule</em></span>.  You have to add a constructor the your 
							<span class="emphasis"><em>UiModule</em></span> that takes an 
							<span class="emphasis"><em>AbstractUiPlugin</em></span> as argument and pass that one to the super constructor. 
							<span class="emphasis"><em>Tip: There is an Eclipse quick fix available for that one.</em></span>
						
</p>
</li>
<li class="listitem">
<p>The interfaces 
							<span class="emphasis"><em>ILexicalHighlightigConfiguration</em></span> and 
							<span class="emphasis"><em>ISemanticHighlightingConfiguration</em></span> have been merged into 
							<span class="emphasis"><em>IHighlightingConfiguration</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>DefaultTemplateProposalProvider</em></span> takes an additional, injectable constructor parameter of type 
							<span class="emphasis"><em>ContextTypeIdHelper</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>HyperlinkHelper</em></span> uses field injection instead of constructor injection. The method 
							<span class="emphasis"><em>createHyperlinksByOffset</em></span> should be overridden instead of the former 
							<span class="emphasis"><em>findCrossLinkedEObject</em></span>.
						</p>
</li>
<li class="listitem">
<p>The API to skip a node in the outline has changed. Instead of returning the _HIDDEN_NODE_ you&rsquo;ll have to implement 
							<span class="emphasis"><em>boolean consumeNode(MyType)</em></span> and return 
							<span class="emphasis"><em>false</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>Readonly*Storage</em></span> implementations have been removed. There is a new API to open editors for objects with a given URI. Please use the 
							<span class="emphasis"><em>IURIEditorOpener</em></span> to create an editor or the 
							<span class="emphasis"><em>IStorage2UriMapper</em></span> to obtain an 
							<span class="emphasis"><em>IStorage</em></span> for a given URI.
						</p>
</li>
<li class="listitem">
<p>The interfaces 
							<span class="emphasis"><em>IStateAccess</em></span> and 
							<span class="emphasis"><em>IEObjectHandle</em></span> have been moved along with the 
							<span class="emphasis"><em>IUnitOfWork</em></span> to the package 
							<span class="emphasis"><em>org.eclipse.xtext.util.concurrent</em></span>.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>ValidationJobFactory</em></span> is gone. Please implement a custom 
							<span class="emphasis"><em>IResourceValidator</em></span> instead.
						</p>
</li>
<li class="listitem">
<p>The grammar elements 
							<span class="emphasis"><em>Alternatives</em></span> and 
							<span class="emphasis"><em>Group</em></span> have a new common super type 
							<span class="emphasis"><em>CompoundElement</em></span>. The methods 
							<span class="emphasis"><em>getGroups</em></span> and 
							<span class="emphasis"><em>getTokens</em></span> have been refactored to 
							<span class="emphasis"><em>getElements</em></span>.
						</p>
</li>
<li class="listitem">
<p>Completion proposals take a 
							<span class="emphasis"><em>StyledString</em></span> instead of a plain string as display string.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>AbstractLabelProvider</em></span> does no longer expose its 
							<span class="emphasis"><em>IImageHelper</em></span>. Use 
							<span class="emphasis"><em>convertToImage</em></span> instead or inject your own 
							<span class="emphasis"><em>IImageHelper</em></span>.
						</p>
</li>
<li class="listitem">
<p>The implementation-classes from 
							<span class="emphasis"><em>org.eclipse.xtext.index</em></span> were superseded by the builder infrastructure. Use the 
							<span class="emphasis"><em>QualifiedNamesFragment</em></span> and the 
							<span class="emphasis"><em>ImportNamespacesScopingFragment</em></span> instead of the 
							<span class="emphasis"><em>ImportedNamespacesScopingFragment</em></span>. Please refer to the section about the builder infrastructure for details.
						</p>
</li>
<li class="listitem">
<p>All the Xtend-based fragments were removed. </p>
</li>
<li class="listitem">
<p>
							
<span class="emphasis"><em>ILinkingService.getLinkText</em></span> was removed. Have a look at the 
							<span class="emphasis"><em>LinkingHelper</em></span> and the 
							<span class="emphasis"><em>CrossReferenceSerializer</em></span> if you relied on this method.
						</p>
</li>
<li class="listitem">
<p>The 
							<span class="emphasis"><em>SerializerUtil</em></span> was renamed to 
							<span class="emphasis"><em>Serializer</em></span>. There were other heavy refactorings that involved the serializer and its components (like e.g. the 
							<span class="emphasis"><em>ITransientValueService</em></span>) but it should be pretty straight forward to migrate existing client code.
						</p>
</li>
<li class="listitem">
<p>The method-signatures of the 
							<span class="emphasis"><em>IFragmentProvider</em></span> have changed. The documentation will give a clue on how to update existing implementations.
						</p>
</li>
<li class="listitem">
<p>Some static methods were removed from utility classes such as 
							<span class="emphasis"><em>EcoreUtil2</em></span> and 
							<span class="emphasis"><em>ParsetreeUtil</em></span> in favor of more sophisticated implementations.
						</p>
</li>
</ul>
</div>
</div>
</body>
</html>
