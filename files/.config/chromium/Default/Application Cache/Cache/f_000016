/*
 * Copyright (c) 2012 Amazon.com, Inc. All rights reserved.
 */
function KindleBookDownloaderFactory(g){var f=5E3,j=0,b=1E3,a={};a.type=g.type;a.asin=g.asin;a.cache=g.cache;a.readAheadActive=!1;a.readAheadPauseCount=0;a.dbPutter=g.dbPutter;a.dbGetIdList=g.dbGetIdList;a.dbOosHandler=g.dbOosHandler;a.dbCheckCache=g.dbCheckCache;a.dbIsCached=g.dbIsCached;a.dbIsOos=g.dbIsOos;a.netGetter=g.netGetter;a.urlGetter=g.urlGetter;a.fileGetter=g.fileGetter;a.fileProgress=g.fileProgress;a.downloadError=g.downloadError;a.pauseReadAhead=function(){this.readAheadPauseCount++};
a.resumeReadAhead=function(a){this.readAheadPauseCount=Math.max(0,--this.readAheadPauseCount);if(this.readAheadPauseCount===0)this.nextReadAheadId=a};a.removeIdFromReadAhead=function(a){if(this.readAheadActive){var e;for(e=0;e<this.readAheadIds.length;e++)if(this.readAheadIds[e]===a){this.readAheadIds.splice(e,1);break}for(e=0;e<this.readAheadUrls.length;e++)if(this.readAheadUrls[e].id===a){this.readAheadUrls.splice(e,1);break}}};a.readAheadOne=function(a){function e(){l.readAheadActive&&(l.numReadAheadNetRequests--,
l.readAheadUrls.length===0?l.numReadAheadNetRequests===0&&setTimeout(function(){l.getReadAheadUrls(a)},l.interReadWait):setTimeout(function(){l.readAheadOne(a)},l.interReadWait))}function b(){e()}function d(a){function d(){l.readAheadRemaining--;l.fileProgress(l.readAheadRemaining);e()}var p;p=a.fragmentMetadata!==void 0?a.fragmentMetadata.id:a.skeletonMetadata!==void 0?a.skeletonMetadata.id:a.glyphFragmentMetadata!==void 0?a.glyphFragmentMetadata.id:void 0;var c=[];c[p]=a;l.dbPutter(c,d,function(a){function p(){l.dbPutter(c,
d,b)}function b(){l.readAheadActive=!1;l.dbIsOos()}!(a.code===Kindle.DB.CONSTRAINT_ERR||a.message==="constraint failed")&&a.code===Kindle.DB.QUOTA_ERR?(l.dbCheckCache(),l.dbOosHandler(p,b)):e()})}var l=this;if(a===this.readAheadGeneration)if(l.readAheadStillAlive++,this.readAheadPauseCount>0)setTimeout(function(){l.readAheadOne(a)},l.startReadWait);else if(l.readAheadUrls.length===0&&l.numReadAheadNetRequests===0)l.getReadAheadUrls(a);else for(;l.numReadAheadNetRequests<l.numReadAhead&&l.readAheadUrls.length>
0;){l.numReadAheadNetRequests++;var f=l.readAheadUrls.shift();l.fileGetter(f,d,b)}};a.getReadAheadUrls=function(a){function b(e){d.readAheadUrls=e;setTimeout(function(){d.readAheadOne(a)},d.interReadWait)}function f(){}var d=this;if(a===this.readAheadGeneration&&this.readAheadActive)if(d.dbCheckCache()){d.readAheadStillAlive++;for(var l=[],q=0;q<d.readAheadIds.length&&d.readAheadIds[q]<d.nextReadAheadId;)q++;q===d.readAheadIds.length&&(q=0);l=d.readAheadIds.splice(q,d.numReadAheadUrls);l.length===
0?d.refreshReadAheadList(a):(d.nextReadAheadId=q<d.readAheadIds.length?d.readAheadIds[q]:0,d.urlGetter(l,b,f))}else d.readAheadActive=!1};a.refreshReadAheadList=function(a){function b(e){function f(){d.getReadAheadUrls(a)}var m=l.createSubTimer("success");d.readAheadStillAlive++;var p,c=[];for(p in e)c[e[p]]=!0;d.readAheadIds=[];for(p=0;p<=d.maxReadAheadId;p++)c[p]||d.readAheadIds.push(p);m.addCount("needed",d.readAheadIds.length);m.addCount("total",d.maxReadAheadId+1);m.endTimer();l.endTimer();l.log();
d.readAheadIds.length>0?(d.readAheadRemaining=d.readAheadIds.length,setTimeout(f,d.startReadWait)):(d.readAheadActive=!1,d.dbIsCached())}function f(){l.endTimer();d.downloadError(Kindle.ERROR.UNKNOWN_DB_ERROR)}var d=this;if(a===this.readAheadGeneration){var l;this.readAheadActive&&(l=KindleMetricsProfiler("bookDownloader.getIdList"),this.dbGetIdList(b,f))}};a.readAheadWatchdog=function(){var a=this;if(this.readAheadActive){if(this.readAheadStillAlive===0)this.readAheadGeneration++,this.readAheadRemaining<
this.generationReadAheadRemaining?(this.numReadAheadNetRequests=0,this.generationReadAheadRemaining=this.readAheadRemaining,this.watchDogTimeout=15E3,this.refreshReadAheadList(this.readAheadGeneration)):this.timeoutRetry?(this.generationReadAheadRemaining=this.readAheadRemaining+1,this.watchDogTimeout=12E4):this.downloadError(Kindle.ERROR.TIMEOUT);setTimeout(function(){a.readAheadWatchdog()},this.watchDogTimeout)}this.readAheadStillAlive=0};a.startReadAhead=function(a,e){var g=this,d=f;this.cache?
(this.readAheadUrls=[],this.readAheadIds=[],this.numReadAheadNetRequests=this.nextReadAheadId=0,this.maxReadAheadId=a,this.readAheadActive=!0,this.readAheadGeneration=this.readAheadStillAlive=0,this.readAheadRemaining=a+1,this.generationReadAheadRemaining=a+2,this.watchDogTimeout=15E3,e?(this.startReadWait=this.interReadWait=d=0,this.numReadAhead=8,this.numReadAheadUrls=200):(this.startReadAheadWait=f,this.interReadWait=j,this.startReadWait=b,this.numReadAhead=4,this.numReadAheadUrls=20,this.timeoutRetry=
!0),this.debugCounter=15,setTimeout(function(){g.readAheadWatchdog()},d)):this.readAheadActive=!1};a.cancelReadAhead=function(){this.readAheadActive=!1;this.readAheadGeneration=-1;this.readAheadIds=this.readAheadUrls=null};a.setReadAheadTimersForTestMode=function(){b=j=f=0};return a}
var KindleReaderBookInfoProvider=function(){var g=3E4,f="fragmentIds",j="glyphIds",b="skeletonIds",a="book_context",k="book_metaData",e="book_key",n="book_skeleton",d="book_fragmap",l="book_ok_to_download";return{BookInfo:function(q,o){function m(){var c=new jQuery.Deferred;KindleLibraryBookCover.getOfflineCover(I).then(function(z){r.getModuleSync(KindleModuleManager.DB_CLIENT).getBookDb().getTable("covers").insertRecord({asin:I,coverData:z}).then(c.resolve,c.reject)},c.reject);return c.promise()}
function p(c){function z(){var z=r.getModuleSync(a);D.savePinningFinishState(c,z).then(d.resolve,d.reject);h&&(u.endMetrics(t),t=null)}function p(){h&&(u.endMetrics(t),t=null);d.reject(Kindle.ERROR.NETWORK)}var h,d=new jQuery.Deferred;t||(t=u.startMetrics("SetOfflineState"),h=!0);aa().done(function(){var h;r.isModuleInitialized(a)?(h=r.getModuleSync(a),h={asin:I,kindleSessionId:h.kindleSessionId,isOffline:c===Kindle.BookInfo.CachedState.PINNED},r.getModuleSync(r.SERVICE_CLIENT).setOfflineStatus(h).then(z,
p)):d.reject()});return d.promise()}function c(){S&&(S.endTimer(),S.log(),S=null);var c=M!==Q&&M!==Kindle.BookInfo.CachedState.PINNED?p(Q):!0;$.when(c).then(function(){m().then(w.resolve,w.resolve)},function(c){c===Kindle.ERROR.NETWORK?w.reject(c):w.reject(Kindle.ERROR.UNKNOWN_DB_ERROR)});D.getBookStatistics().then(function(c){L.metricId&&(c.fragments!==void 0&&(u.increaseSubCounter(L.metricId,"fragmentCount",c.fragments.count),u.increaseSubCounter(L.metricId,"fragmentsSize",c.fragments.size)),c.glyphs!==
void 0&&(u.increaseSubCounter(L.metricId,"glyphCount",c.glyphs.count),u.increaseSubCounter(L.metricId,"glyphsSize",c.glyphs.size)),u.endMetrics(L.metricId))},function(){L.metricId&&u.endMetrics(L.metricId)})}function h(c,z,a){function h(c,d,p){function b(c){if(c.skeletonMetadata!==void 0&&c.skeletonMetadata.encryption===1){var a=KindleO_Aaa.o_aad(c.skeletonData,f);c.skeletonData=a;delete c.skeletonMetadata.encryption}z(c)}function l(c,z){a(null,z,null,p)}var f;r.getModule(e).then(function(a){f=a;
x(c,b,l,d)},a)}function d(c,h,p){function b(c){if(c.fragmentMetadata!==void 0&&c.fragmentMetadata.encryption===1){var a=KindleO_Aaa.o_aad(c.fragmentData,f);c.fragmentData=a;delete c.fragmentMetadata.encryption}z(c)}function l(c,z){a(null,z,null,p)}var f;r.getModule(e).then(function(a){f=a;x(c,b,l,h)},a)}function p(c,h,d){x(c,function(c){if(c.glyphFragmentMetadata!==void 0)c.glyphFragmentMetadata.id=d;z(c)},function(c,z){a(null,z,null,d)},h)}if(c.skeletonUrls)for(var b=c.skeletonUrls,l=0;l<b.length;l++)h(b[l].signedUrl,
"loadSkeleton"+b[l].id,b[l].id);if(c.fragmentUrls){b=c.fragmentUrls;for(l=0;l<b.length;l++)d(b[l].signedUrl,"loadFragment"+b[l].id,b[l].id)}if(c.glyphUrls){c=c.glyphUrls;for(b=0;b<c.length;b++)p(c[b].signedUrl,"loadGlyphFragment"+c[b].id,c[b].id)}}function O(c,z){var h=new jQuery.Deferred;r.getModule(a).done(function(a){var d={asin:I,contentVersion:a.contentVersion,formatVersion:a.formatVersion,isSample:T};if(a.kindleSessionId)d.kindleSessionId=a.kindleSessionId;if(a.basePath)d.basePath=a.basePath;
if(a.useNewPath)d.useNewPath=a.useNewPath;if(a.useProdBucket)d.useProdBucket=a.useProdBucket;d[c]=z;r.getModuleSync(r.SERVICE_CLIENT).getFileUrl(d).then(h.resolve,h.reject)});return h.promise()}function y(){var a=r.getModuleSync(k),z=r.getModuleSync(d);ba?M===Kindle.BookInfo.CachedState.CACHED||M===Kindle.BookInfo.CachedState.PINNED?c():D.computeCacheQuota().then(function(){S=KindleMetricsProfiler("readAhead");L.fragmentsDownloading=!0;J.startReadAhead(z.fragmentMetadata.numberOfFragments-1,da);if(a.numOfGlyphFragments)L.glyphsDownloading=
!0,K.startReadAhead(a.numOfGlyphFragments-1)},w.reject):w.reject()}function s(c){J&&(J.cancelReadAhead(),J=null);K&&(K.cancelReadAhead(),K=null);w.reject(c)}function E(){function c(z){u.startSubTimer(t,"getFragMap");var h=r.getModuleSync(a);x(h.fragmentMapUrl,function(c){z.resolve(c);u.endSubTimer(t,"getFragMap")},function(c,a){z.reject(a)},"loadFragmap")}r.isModuleRegistered(d)||r.registerModuleWithInitializer(d,c);return r.getModule(d)}function v(c){var a;c.cpr!==void 0&&(a={},KindleCompression.lzAddStringsToDictionary(c.cpr,
a),KindleCompression.lzAddNumbersToDictionary(a),R=KindleCompression.lzGetDecompressionDictionary(a));c.cprJson!==void 0&&(a={},KindleCompression.lzAddStringsToDictionary(c.cprJson,a,256),KindleCompression.lzAddNumbersToDictionary(a,256),V=KindleCompression.lzGetDecompressionDictionary(a))}function P(){function c(z){u.startSubTimer(t,"getMetaData");var h=r.getModuleSync(a);x(h.metadataUrl,function(c){v(c);u.endSubTimer(t,"getMetaData");z.resolve(c)},function(c,a){z.reject(a)},"loadMetadata")}r.isModuleRegistered(k)||
r.registerModuleWithInitializer(k,c);return r.getModule(k)}function A(){function c(z){var h=r.getModuleSync(a),h={asin:I,contentVersion:h.contentVersion,formatVersion:h.formatVersion};r.getModuleSync(r.SERVICE_CLIENT).getBookKeyUrl(h,function(c){KindleO_Aaa.iToStr(c,z.resolve,z.reject)},z.reject)}r.isModuleRegistered(e)||r.registerModuleWithInitializer(e,c);return r.getModule(e)}function F(){function c(a){if(a.skeletonMetadata.compression===1)a.skeletonData=KindleCompression.lzExpandWithStaticDictionary(a.skeletonData,
R),delete a.skeletonMetadata.compression;return a}function a(h){G.getPieces([0],function(a){r.getModule(k).then(function(){h.resolve(c(a));u.endSubTimer(t,"getSkeleton")},h.reject)},h.reject)}r.isModuleRegistered(n)||(u.startSubTimer(t,"getSkeleton"),r.registerModuleWithInitializer(n,a));return r.getModule(n)}function x(c,a,h,d){var p=new jQuery.Deferred;$.jsonp({url:c,callback:d,cache:!0,timeout:g,error:function(c,a){h&&h(c,a);p.reject(a)},success:function(c){a&&a(c);p.resolve(c)}});return p.promise()}
function B(){var a={asin:I,type:"fragment",cache:Y,netGetter:function(c,a,h){U(f,c,a,h)},dbGetter:function(c,a,h){D.getFragments(c).then(a,h)},dbGetIdList:function(c,a){D.getFragmentIds().then(c,a)},dbPutter:function(c,a,h){D.putFragments(c).then(a,h)},dbCheckCache:function(){var c=D.getCacheQuota();return c.cachedSize>c.cacheQuota?(s(Kindle.ERROR.OUT_OF_SPACE),!1):!0},dbOosHandler:function(c,a){r.getModuleSync(r.DB_CLIENT).getBookDb().deleteOldestBookData(I).then(c,a)},dbIsCached:function(){L.fragmentsDownloading=
!1;L.glyphsDownloading||c()},dbIsOos:function(){s(Kindle.ERROR.OUT_OF_SPACE)},urlGetter:function(c,a,h){$.when(O(f,c)).then(function(c){a(c.fragmentUrls)},h)},fileGetter:function(c,a,d){h({fragmentUrls:[c]},a,d)},fileProgress:function(c){var a;N&&(a=r.getModuleSync(d),N(a.fragmentMetadata.numberOfFragments-c,a.fragmentMetadata.numberOfFragments))},downloadError:function(c){s(c)}};J=KindleBookDownloaderFactory(a);a.downloader=J;ca=KindleBookPieceManagerFactory(a);G=KindleBookPieceManagerFactory({asin:I,
type:"skeleton",cache:Y,netGetter:function(c,a,h){U(b,c,a,h)},dbGetter:function(c,a,h){D.getSkeleton(c).then(a,h)},dbPutter:function(c,a,h){D.putSkeletons(c).then(a,h)},dbOosHandler:function(c,a){r.getModuleSync(r.DB_CLIENT).getBookDb().deleteOldestBookData(I).then(c,a)},downloader:{pauseReadAhead:function(){},resumeReadAhead:function(){},removeIdFromReadAhead:function(){}}});a={asin:I,type:"glyph",cache:Y,netGetter:function(c,a,h){U(j,c,a,h)},dbGetter:function(c,a,h){D.getGlyphs(c).then(a,h)},dbGetIdList:function(c,
a){D.getGlyphIds().then(c,a)},dbPutter:function(c,a,h){D.putGlyphs(c).then(a,h)},dbCheckCache:function(){return!0},dbOosHandler:function(c,a){D.deleteOldestBookData(I).then(c,a)},dbIsCached:function(){L.glyphsDownloading=!1;L.fragmentsDownloading||c()},dbIsOos:function(){s(Kindle.ERROR.OUT_OF_SPACE)},urlGetter:function(c,a,h){$.when(O(j,c)).then(function(c){a(c.glyphUrls)},h)},fileGetter:function(c,a,d){h({glyphUrls:[c]},a,d)},fileProgress:function(){},downloadError:function(c){s(c)}};K=KindleBookDownloaderFactory(a);
a.downloader=K;W=KindleBookPieceManagerFactory(a)}function aa(){function c(h){if(h.cacheState&&(M=h.cacheState,M===Kindle.BookInfo.CachedState.PINNING))Q=Kindle.BookInfo.CachedState.PINNED;h.context!==void 0&&r.registerModule(a,h.context);h.metadata!==void 0&&(v(h.metadata),r.registerModule(k,h.metadata));h.fragmap!==void 0&&r.registerModule(d,h.fragmap);u.endSubTimer(t,"checkDB");Z.resolve(h)}function h(c){u.endSubTimer(t,"checkDB");c&&c.code===Kindle.DB.DATABASE_ERR&&c.message.indexOf("no such table")>=
0&&r.getModuleSync(r.APP_REGISTRATION).deregister();Z.resolve()}if(!Z){Z=new jQuery.Deferred;u.startSubTimer(t,"checkDB");var p=r.getModuleSync(r.DB_CLIENT);p.getBookDb()?(D=p.getBookDb().BookInfoDB(I),D.getBookInfo().then(c,h)):(Y=ba=!1,h())}return Z.promise()}function fa(){L.metricId=u.startMetrics("BookDownload::Reading",u.BREAK_DOWN_HARDWARE);r.getModuleList([a,k,d,n,l]).done(function(c){var h=$.extend({},c[a]);delete h.kindleSessionId;c={metadata:c[k],fragmap:c[d],context:h,cacheState:H};D&&
Y&&D.insertBookInfo(c)})}function X(c,h){function p(c){j.endTimer();u.endMetrics(O,!0);(function(){var p;if(c.downloadRestrictionReason)v.reject(c.downloadRestrictionReason.reasonCode);else{p=o.createSubTimer("finishStartReading");if(r.isModuleInitialized(a)){var b=r.getModuleSync(a);if(b.contentVersion===c.contentVersion&&b.lastPageReadData.position!==c.lastPageReadData.position)b.lastPageReadData=c.lastPageReadData,D.updateBookContext(b);b.kindleSessionId=c.kindleSessionId}else r.registerModule(a,
c);if(c.isSample)T=!0,ba=Y=!1,r.registerModule(e,!0);else if(q.isSample===!0){p.endTimer();o.endTimer();o.log();v.reject(Kindle.ERROR.UNKNOWN_ERR);return}m||(B(),F(),P(),fa());ca.setNetworkReady();W.setNetworkReady();G.setNetworkReady();p.endTimer();p=o.createSubTimer("resolve");v.resolve(!0);p.endTimer();o.endTimer();o.log();$.when(P(),E(),A(),F()).fail(function(){h("LoadFailure")});r.getModuleList([a,k,d,n,l]).done(y).fail(w.reject)}})()}function b(c){m?v.resolve(!1):v.reject(c);M===Kindle.BookInfo.CachedState.PINNED?
w.resolve():w.reject(Kindle.ERROR.NETWORK)}function f(c){g.endTimer();m=c;O=u.startMetrics("Reader::StartReading");j=o.createSubTimer("startReading");c=$.extend({asin:I},q);if(m&&m.context&&M===Kindle.BookInfo.CachedState.PINNED)c.kindleSessionId=m.context.kindleSessionId;s=ea(c);m&&(B(),ca.setNetworkReady(),W.setNetworkReady(),G.setNetworkReady(),F());s.then(p,b)}var m,o,g,j,O,s,v=new jQuery.Deferred;w=new jQuery.Deferred;t=c;o=KindleMetricsProfiler("bookInfo.startReading");g=o.createSubTimer("getInfoFromDB");
q.isSample===!0?f(null):aa().done(f);return v.promise()}function C(){var c=q.bucket+"/"+q.asin+"/"+q.version;c+=q.sample===void 0?"/book":"/sample";var a={baseUrl:c,fragmentMapUrl:c+"/frags/gz_fragmap.jsonp",imageBaseUrl:c,locationMapUrl:c+"/locations.jsonp",metadataUrl:c+"/metadata.jsonp",mobiToHtmlUrl:c+"/mobiToHtml.jsonp",htmlToMobiUrl:c+"/htmlToMobi.jsonp",version:q.version,auth:q.auth?q.auth:"",contentKey:q.key?q.key:"",lastPageReadData:{deviceName:null,position:-1,syncTime:0}},d=a.contentKey;
q.key&&(_deferredKey=new jQuery.Deferred,_deferredKey.resolve());ea=function(){return(new jQuery.Deferred(function(c){c.resolve(d)})).promise()};U=function(c,d,p,l){var e=[],m=[],o=[];switch(c){case b:for(c=0;c<d.length;c++)o.push({id:d[c],signedUrl:a.baseUrl+"/frags/gz_skeleton"+d[c]+".jsonp"+a.auth});break;case f:for(c=0;c<d.length;c++)e.push({id:d[c],signedUrl:a.baseUrl+"/frags/gz_frag"+d[c]+".jsonp"+a.auth});break;case j:for(c=0;c<d.length;c++)m.push({id:d[c],signedUrl:a.baseUrl+"/glyphs/glyphFragment"+
d[c]+".jsonp"+a.auth})}d={};if(o.length)d.skeletonUrls=o;if(e.length)d.fragmentUrls=e;if(m.length)d.glyphUrls=m;h(d,p,l)}}var I=q.asin,T,r=o||KindleModuleManager,u=r.getModuleSync(r.METRICS_MANAGER),Z=null,D=null,M=null,R=null,V=null,ba=!0,Y=!0,L={},ca=null,G=null,W=null,J=null,K=null,w=null,N=null,Q=Kindle.BookInfo.CachedState.CACHED,da=!1,H=Kindle.BookInfo.CachedState.PARTIAL,S=null,t=null,U=function(c,a,d,p){$.when(O(c,a)).then(function(c){h(c,d,p)},function(c,h,d){p(c,h,d,a)})},ea=function(c){var a=
new jQuery.Deferred;r.getModuleSync(r.SERVICE_CLIENT).startReading(c).then(function(c){if(q.basePath)c.basePath=q.basePath;if(q.useNewPath)c.useNewPath=q.useNewPath;if(q.useProdBucket)c.useProdBucket=q.useProdBucket;a.resolve(c)},function(){a.reject("timeout")});return a.promise()};q.bucket!==void 0&&C();return{getAsin:function(){return I},startReading:function(c,a){r.registerModule(l,!0);return X(c,a)},doneReading:function(){J&&J.cancelReadAhead();K&&K.cancelReadAhead()},getImageBaseUrl:function(){return r.getModuleSync(a).imageBaseUrl+
"/"},getKindleSessionId:function(){return r.getModuleSync(a).kindleSessionId},getFragmentMap:function(c,a){setTimeout(function(){r.getModule(d).then(c,a)},15)},getBookType:function(){var c=new jQuery.Deferred;r.getModule(d).then(function(a){c.resolve(a.fragmentMetadata.bookType)},c.reject);return c.promise()},isBookSample:function(){return T},getBookSkeleton:function(c,a){r.getModule(n).then(c,a)},getBookFragments:function(c,a,h){ca.getPieces(h,function(a){if(a.fragmentMetadata.compression===1||a.fragmentMetadata.compression===
2){a.fragmentData=KindleCompression.lzExpandWithStaticDictionary(a.fragmentData,R);if(a.paraData!==void 0&&typeof a.paraData==="string"){var h=KindleCompression.lzExpandWithStaticDictionary(a.paraData,V,256);a.paraData=JSON.parse(h)}delete a.fragmentMetadata.compression}c(a)},a)},getGlyphFragments:function(c,a,h){W.getPieces(h,function(a){if(a.glyphFragmentMetadata.compression===1||typeof a.glyphData==="string"){var h=KindleCompression.lzExpandWithStaticDictionary(a.glyphData,V,256);a.glyphData=JSON.parse(h);
delete a.glyphFragmentMetadata.compression}c(a)},a)},getMetadata:function(c,a){return r.getModule(k).then(c,a)},UNKNOWN_FPR:-1,getFurthestPositionReadData:function(){return r.getModuleSync(a).lastPageReadData},getBookPositions:function(){var c=new jQuery.Deferred;r.getModule(k).then(function(h){var d=KindleModuleManager.getModuleSync(a);c.resolve({toc:h.positions.toc,srl:d.srl||h.positions.srl,cover:h.positions.cover})},c.reject);return c.promise()},startDownloading:function(c,a,h){Q=Kindle.BookInfo.CachedState.PINNED;
da=!0;r.registerModuleWithDeferred(l,h);return X(c,a)},cancelDownloading:function(){J.cancelReadAhead();K.cancelReadAhead();w.reject(Kindle.ERROR.CANCELLED)},getDownloadComplete:function(c){N=c;return w.promise()},isBookDownloaded:function(){return M===Kindle.BookInfo.CachedState.CACHED||M===Kindle.BookInfo.CachedState.PINNED},setCachedState:p,getSizeInfo:function(){var c=new jQuery.Deferred;$.when(r.getModule(k),D.computeCacheQuota()).then(function(a,h){c.resolve({bookSize:a.bookSize,quota:h})},
c.reject);return c.promise()}}}}}();
function KindleBookPieceManagerFactory(g){var f={},j;f.type=g.type;f.asin=g.asin;f.cache=g.cache;f.dbGetter=g.dbGetter;f.dbPutter=g.dbPutter;f.downloader=g.downloader;f.netGetter=g.netGetter;f.getPieces=function(b,a,f){function e(h){for(var d in h)a(h[d]);var p=[],b;for(b=0;b<o.length;b++)d=o[b],h[d]===void 0&&p.push(d);o=p;p.length>0?q(p):m.downloader.resumeReadAhead(c)}function g(){j||(j=new jQuery.Deferred);j.done(function(){q(o)})}function d(h){function d(){a(h)}var b;b=h.fragmentMetadata!==void 0?
h.fragmentMetadata.id:h.skeletonMetadata!==void 0?h.skeletonMetadata.id:h.glyphFragmentMetadata!==void 0?h.glyphFragmentMetadata.id:void 0;if(m.cache){var l=[];l[b]=h;m.dbPutter(l,d,d);m.downloader.removeIdFromReadAhead(b);--p===0&&m.downloader.resumeReadAhead(c)}else a(h)}function l(c,a,p,b){var e;Object.prototype.toString.call(b)==="[object Array]"?(e=b,b="list"):e=[b];h[b]=h[b]+1||1;h[b]<=2?m.netGetter(e,d,l):f(c,a,p)}function q(c){p=c.length;m.netGetter(c,d,l)}Object.prototype.toString.call(b)!==
"[object Array]"&&(b=[b]);var o=b.slice(0),m=this,p=0,c=Math.max.apply(Math,o)+1,h=[];this.cache?(this.downloader.pauseReadAhead(),this.dbGetter(b,e,g)):q(b)};f.setNetworkReady=function(){j||(j=new jQuery.Deferred);j.resolve()};return f}
var KindleCompression=function(){function g(a,d,b){var e,b=b>0?b:k;for(e in d)d[e]>=b&&(b=d[e]+1);e=b;for(var p in a)for(var b=a[p],c=2;c<=b.length;c++){var h=b.substr(0,c);d.hasOwnProperty(h)||(d[h]=e++)}return d}function f(a,f){var o,m=k;o="";for(var p=0;p<f.length;){var c=f.charAt(p);p++;c.charCodeAt(0)<=b?a.hasOwnProperty(o+c)?o+=c:(o.length>0&&m<e&&(a[o+c]=m,m++,m===n&&(m=d)),o=c):o=""}return a}function j(){if(defaultDictionary===void 0||defaultDictionary==={})defaultDictionary=f({},defaultDictionaryString);
return defaultDictionary}var b=9983,a=b+1,k=a+100+1,e=65533,n=55295,d=57344;return{lzCompress:function(l){var f={},o=[],m,p=k,c,h,g;c=m="";for(var j=0;j<l.length;){var s=l.charAt(j);j++;if(s.charCodeAt(0)<=b){for(;c.length>0;){h=Math.min(100,c.length);g=c.substr(0,h);c=c.substr(h);o.push(a+h);for(h=0;h<g.length;h++)o.push(g.charCodeAt(h))}f.hasOwnProperty(m+s)?m+=s:(m.length>0&&(o.push(m.length===1?m.charCodeAt(0):f[m]),p<e&&(f[m+s]=p,p++,p===n&&(p=d))),m=s)}else m.length>0&&(o.push(m.length===1?
m.charCodeAt(0):f[m]),m=""),c+=s}for(m.length>0&&o.push(m.length===1?m.charCodeAt(0):f[m]);c.length>0;){h=Math.min(100,c.length);g=c.substr(0,h);c=c.substr(h);o.push(a+h);for(h=0;h<g.length;h++)o.push(g.charCodeAt(h))}for(i=0;i<o.length;i++)o[i]=String.fromCharCode(o[i]);return o.join("")},lzExpand:function(l){for(var f={},o=[],m,p=k,c="",h,g=0;g<l.length;){m=l.charCodeAt(g);g++;if(m<=b)m=String.fromCharCode(m);else if(m>=k)(m=f[m])||(m=c+h);else{c=m-a;o.push(l.substr(g,c));g+=c;c="";continue}o.push(m);
h=m.charAt(0);p<e&&c.length>0&&(f[p]=c+h,p++,p===n&&(p=d));c=m}return o.join("")},lzBuildDictionary:f,lzGetDecompressionDictionary:function(a){var d=[],b;for(b in a)d[a[b]]=b;return d},lzAddStringsToDictionary:g,lzAddNumbersToDictionary:function(a,d){for(var b=[],e=100;e<1E3;e++)b.push(""+e);return g(b,a,d)},lzCompressWithStaticDictionary:function(d,e){if(e===void 0||e==={})e=j();var f=[],m,p,c,h;p=m="";for(var g=0;g<d.length;){var k=d.charAt(g);g++;if(k.charCodeAt(0)<=b){for(;p.length>0;){c=Math.min(100,
p.length);h=p.substr(0,c);p=p.substr(c);f.push(a+c);for(c=0;c<h.length;c++)f.push(h.charCodeAt(c))}e.hasOwnProperty(m+k)?m+=k:(m.length>0&&f.push(m.length===1?m.charCodeAt(0):e[m]),m=k)}else m.length>0&&(f.push(m.length===1?m.charCodeAt(0):e[m]),m=""),p+=k}for(m.length>0&&f.push(m.length===1?m.charCodeAt(0):e[m]);p.length>0;){c=Math.min(100,p.length);h=p.substr(0,c);p=p.substr(c);f.push(a+c);for(c=0;c<h.length;c++)f.push(h.charCodeAt(c))}for(i=0;i<f.length;i++)f[i]=String.fromCharCode(f[i]);return f.join("")},
lzExpandWithStaticDictionary:function(d,e,f){if(e===void 0||e===[]){if(defaultDeDictionary===void 0||defaultDeDictionary===[]){j();defaultDeDictionary=[];for(var g in defaultDictionary)defaultDeDictionary[defaultDictionary[g]]=g}e=defaultDeDictionary}g=b;var p=k;f!==void 0&&(g=f-1,p=f);for(var f=[],c=0;c<d.length;){var h=d.charCodeAt(c);c++;h<=g?f.push(String.fromCharCode(h)):h>=p?f.push(e[h]):(h-=a,f.push(d.substr(c,h)),c+=h)}return f.join("")}}}(),KindleO_Aaa=function(){function g(a){for(var d=
[],c,h,e,f,l,g,k=0;k<a.length;)c=a.charCodeAt(k++)&255,h=a.charCodeAt(k++)&255,e=a.charCodeAt(k++)&255,f=c>>2,c=(c&3)<<4|h>>4,l=(h&15)<<2|e>>6,g=e&63,isNaN(h)?l=g=64:isNaN(e)&&(g=64),d.push(b.charAt(f)+b.charAt(c)+b.charAt(l)+b.charAt(g));return d.join("")}function f(a,d){var c=[];c.length=256;for(var h=0;h<256;h++)c[h]=h;for(var b=0,e,h=0;h<256;h++)b=b+c[h]+d[h%d.length]&255,e=c[h],c[h]=c[b],c[b]=e;for(var b=h=0,f=[],g=0;g<a.length;g++)h=h+1&255,b=b+c[h]&255,e=c[h],c[h]=c[b],c[b]=e,f.push(String.fromCharCode(a.charCodeAt(g)^
c[c[h]+c[b]&255]));return f.join("")}function j(a,d){for(var c="",h=d?n:e,b=h.length,f=0;f<a;f++)c+=h.charAt(Math.floor(Math.random()*b));return c}for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=[],k=0;k<b.length;k+=1)a[b.charCodeAt(k)]=k;for(var e="eeeeeeeeeeeeeeeeettttttttaaaaaaaaaaaaaaaaooooooiiiiiiinnnnssssrrrrhhhhllldddcccuuummmfffpoggwwyybbvkxjqz",n=e+"                                             ",d=[],l=0;l<10;l++)d[l]=j(15,!1);var q=["p","span","div","em",
"i","strong","b","a","big","small"],o=!1;return{iToStr:function(a,d,c){var h=new Image;h.onload=function(){var c=KindleHostDeviceDetector.isIE(),a=h.height,b=h.width,e=document.createElement("canvas").getContext("2d");e.drawImage(h,0,0);for(var f,g,l,k,m,n="",j=0,o,q=0;q<a;){f=e.getImageData(0,q,b,1);j=0;for(o=f.data.length-4;j<o;){g=f.data[j++]&7;l=f.data[j++]&3;k=f.data[j++]&7;j++;m=g*32+l*8+k;if(c){var C=void 0,C=0;m>=65&&m<=90||m>=50&&m<=55||m===0?C=m:(C=g>=2?-1:1,C=(g+C+8)%8*32+(l+C+4)%4*8+(k+
C+8)%8);C>=65&&C<=90||C>=50&&C<=55||(C=0);m=C}if(m===0)break;n+=String.fromCharCode(m)}if(m===0)break;q++}d(n)};h.onerror=function(){c()};h.src=a},o_aaa:g,o_aac:function(a,d){var c;c=a.replace(/\x0d\x0a/g,"\n");for(var h=[],b=0;b<c.length;b++){var e=c.charCodeAt(b);e<128?h.push(String.fromCharCode(e)):(e>127&&e<2048?h.push(String.fromCharCode(e>>6|192)):(h.push(String.fromCharCode(e>>12|224)),h.push(String.fromCharCode(e>>6&63|128))),h.push(String.fromCharCode(e&63|128)))}c=h.join("");h=d;h+="00000000000000000000000000000000".substring(0,
32-h.length);b=[];for(k=0;k<h.length;k+=2)b.push(parseInt(h.substring(k,k+2),16));return g(f(c,b))},o_aad:function(d,b){var c;c=[];for(var h,e,g,l,k,n=0;n<d.length;)h=a[d.charCodeAt(n++)],e=a[d.charCodeAt(n++)],l=a[d.charCodeAt(n++)],k=a[d.charCodeAt(n++)],h=h<<2|e>>4,e=(e&15)<<4|l>>2,g=(l&3)<<6|k,c.push(String.fromCharCode(h)),l!==64&&c.push(String.fromCharCode(e)),k!==64&&c.push(String.fromCharCode(g));c=c.join("");l=[];for(k=0;k<b.length;k++)l.push(b.charCodeAt(k));c=f(c,l);l=[];for(k=0;k<c.length;)n=
c.charCodeAt(k),n<128?(l.push(String.fromCharCode(n)),k++):n>191&&n<224?(h=c.charCodeAt(k+1),l.push(String.fromCharCode((n&31)<<6|h&63)),k+=2):(h=c.charCodeAt(k+1),e=c.charCodeAt(k+2),l.push(String.fromCharCode((n&15)<<12|(h&63)<<6|e&63)),k+=3);return l.join("")},o_aae:function(a){var b;if(!o){for(b=0;b<10;b++)$(d[b]).addClass("noDisplay");o=!0}var c=$(a).html(),h=!1,e="",f=0;for(b=0;b<c.length;b++)if(c[b]===">")h=!1;else if(c[b]==="<")h=!0;else if(b%60===7&&!h){e+=c.substring(f,b);var f=b,l=q[Math.floor(Math.random()*
q.length)];e+="<"+l+' class="'+d[Math.floor(Math.random()*d.length)]+'">'+j(30,!0)+"</"+l+">"}e+=c.substring(f,c.length);$(a).html(e)},o_aaf:function(a){a:{for(var b=0;b<d.length;b++)if(d[b]===a){a=!0;break a}a=!1}return a}}}();function KindleAssert(){}
var KindleDebug=function(){return{error:function(){},log:function(){},warn:function(){},saveLogs:function(){saveLog=!0}}}(),KindleHostDeviceDetector=function(){function g(){return navigator.platform.indexOf("iPad")!==-1}function f(){return navigator.platform.indexOf("iPhone")!==-1||navigator.platform.indexOf("iPod")!==-1}function j(){return navigator.userAgent.indexOf("Cloud9")!==-1}function b(){return"standalone"in navigator&&navigator.standalone}function a(){return window.chrome&&window.top.chrome.app&&
window.top.chrome.app.isInstalled}function k(){return navigator.userAgent.indexOf("PlayBook")!==-1}return{isiOS:function(){return g()||f()||k()||j()},isiPad:g,isiPad1:function(){return g()&&KindleHostPadDetector.isPad1(b())},isiPhone:f,isiOS_4x:function(){return(g()||f())&&navigator.userAgent.indexOf("OS 4")!==-1},isiOS_5x:function(){return(g()||f())&&navigator.userAgent.indexOf("OS 5")!==-1},isFirefox:function(){return navigator.userAgent.indexOf("Firefox")!==-1},isSafari:function(){return navigator.userAgent.indexOf("Safari")!==
-1},isIE:function(){return navigator.userAgent.indexOf("MSIE")!==-1},isPlayBook:k,isCloud9:j,isOnline:function(){return navigator.onLine},isChrome:function(){return window.chrome},isiOSAppMode:b,isChromeApp:a,isInAppMode:function(){return b()||a()},isCookieEnabled:function(){return navigator.cookieEnabled},isLocalStorageEnabled:function(){if(KindleLocalStorage.localStorageObject===null)return!1;try{KindleLocalStorage.localStorageObject.setItem("testLocalStorage","1"),KindleLocalStorage.localStorageObject.removeItem("testLocalStorage")}catch(a){return!1}return!0},
isWebSQLSupported:function(){return!!window.openDatabase},isIndexedDBSupported:function(){return!!window.mozIndexedDB||!!window.webkitIndexedDB},getDevicePlatform:function(){return g()?"iPad":f()?"iPhone":k()?"playBook":j()?"otter":"desktop"}}}(),KindleHostPadDetector=function(){return{isPad1:function(g){if(KindleLocalStorage.localStorageObject.getItem("definitelyNotPad1"))return!1;var f=0,j=1E3,b=0,a;for(i=0;i<3;i++)a=SunSpiderBenchmark.get3DSpeed(),a>f?f=a:a<j&&(j=a),b+=a;f=b/3;if(f>=200&&g)return!0;
if(f>=100&&!g)return!0;KindleLocalStorage.localStorageObject.setItem("definitelyNotPad1","true");return!1}}}();
function KindleInterfacesFactory(){function g(f,g){for(var b in g)if(g.hasOwnProperty(b)&&typeof f[b]!==typeof g[b])return!1;return!0}return{IKindleLibrary:{onReaderOpenStatus:function(){},onReaderClose:function(){},onStoreOpenStatus:function(){},libraryUpdateNeeded:function(){}},IKindleReader:{openBook:function(){},unloadReader:function(){},onStoreOpenStatus:function(){},onBookExtrasOpenStatus:function(){},pauseReader:function(){},resumeReader:function(){}},IKindleAppForLibrary:{openStore:function(){},
openBook:function(){},onLibraryLoaded:function(){},getQueryParameters:function(){}},IKindleAppForReader:{onReaderReady:function(){},closeReader:function(){},onStartReadingStatus:function(){},onRendererLoaded:function(){},openBookExtras:function(){},openStore:function(){}},checkImplements:g,assertImplements:function(f,j){KindleAssert(g(f,j),"Object fails to provide all properties of interface prototype")}}}
var KindleInterfaces=KindleInterfacesFactory(),KindlJournalManager=function(){function g(a){var d=[],b;for(b in a){var e=a[b].entry;e&&d.push(e)}return d}function f(b){var d=[],e;for(e in b)d.push({entry:b[e]});return k.getAppDb().getTable(a).insertList(d)}function j(a){var b=new jQuery.Deferred;e.updateAnnotations(a,KindleLocale.getLocalTimeOffset()).then(function(a){(a=a.Output.validAnnotations)&&a>0?b.resolve():b.reject()},function(){b.reject()});return b.promise()}function b(){var b=new jQuery.Deferred;
k.getAppDb().getTable(a).getRecord().then(function(a){function e(){k.getAppDb().deleteJournalEntries(a).then(b.resolve,b.reject)}var f=g(a);f.length>0?j(f).then(e,b.reject):b.resolve()},b.reject);return b.promise()}var a="journal",k=null,e=null;return{initialize:function(){var a=new jQuery.Deferred,b=this;KindleModuleManager.getModuleList([KindleModuleManager.SERVICE_CLIENT,KindleModuleManager.DB_CLIENT]).then(function(f){e=f[KindleModuleManager.SERVICE_CLIENT];k=f[KindleModuleManager.DB_CLIENT];
a.resolve(b)},a.reject);return a.promise()},saveToJournal:function(a){var d=new jQuery.Deferred;f(a).then(function(){b().then(d.resolve,d.resolve)},d.reject);return d.promise()},uploadJournal:b}}(),KindleLegacyDeviceTokenStorage=function(){return{hasDeviceTokenFromStorage:function(){return KindleLocalStorage.localStorageObject.getItem("kindleDeviceToken")!==null},getDeviceTokenFromStorage:function(){return KindleLocalStorage.localStorageObject.getItem("kindleDeviceToken")},setDeviceToken:function(g){KindleLocalStorage.localStorageObject.setItem("kindleDeviceToken",
g)},clearDeviceTokenFromStorage:function(){KindleLocalStorage.localStorageObject.removeItem("kindleDeviceToken")}}}(),KindleLocalStorage=function(){var g=null;if("localStorage"in window&&window.localStorage!==null&&window.localStorage)g=window.localStorage;return{localStorageObject:g}}(),KindleLocale=function(){var g=-(new Date).getTimezoneOffset();return{getLocalTimeOffset:function(){return g},getCountryCode:function(){return"US"}}}(),KindleMetricsProfiler=function(g){function f(b){for(var a=0,f=
0;f<b.length;f+=1)a+=b[f].end-b[f].start;return a}var j={};j.name=g;j.counters=null;j.subTimers=null;j.runs=[{start:(new Date).getTime(),end:null}];j.endTimer=function(){var b=this.runs[this.runs.length-1];if(b.end===null)b.end=(new Date).getTime()};j.addCount=function(b,a){if(this.counters===null)this.counters={};this.counters[b]===void 0?this.counters[b]=a:this.counters[b]+=a};j.createSubTimer=function(b){if(this.subTimers===null)this.subTimers={};this.subTimers[b]===void 0?this.subTimers[b]=KindleMetricsProfiler(b):
this.subTimers[b].runs.push({start:(new Date).getTime(),end:null});return this.subTimers[b]};j.log=function(){this.logAsPercentageOfTime("",f(this.runs))};j.logAsPercentageOfTime=function(b,a){var g=b+":"+this.name,e;f(this.runs);for(e in this.counters);for(e in this.subTimers)this.subTimers[e].logAsPercentageOfTime(g,a)};return j};
function KindleModuleManagerFactory(){function g(a,c){if(o[a])throw"Duplicate registration of module "+a;if(!c)throw"Module is not initialized with an object "+a;o[a]=c;m[a].resolve(c)}function f(a){if(o.hasOwnProperty(a))throw"Duplicate registration of module "+a;o[a]=void 0}function j(a,c){m[a]||(m[a]=new jQuery.Deferred);g(a,c)}function b(a,c){f(a);m[a]||(m[a]=new jQuery.Deferred);c(m[a]);m[a].done(function(c){g(a,c)})}function a(a){m[a]||(m[a]=new jQuery.Deferred);return m[a].promise()}function k(a){if(!o[a])throw"Trying to get uninitialized module "+
a;return o[a]}function e(a,c){o[a]=c}function n(a){var c=o[a];return{done:function(a){a(c)},fail:function(){},when:function(a){a(c)}}}function d(a){for(var c={},b=0;b<a.length;b++)c[name]=o[a];return{done:function(a){a(c)},fail:function(){},when:function(a){a(c)}}}function l(){o={}}var q={CONSTANTS:"Constants",APPCACHE_EVENTHANDLER:"appcache_eventHandler",DB_CLIENT:"DBClient",METRICS_MANAGER:"metrics_manager",SERVICE_CLIENT:"ServiceClient",APP_REGISTRATION:"Registration",JOURNAL_MANAGER:"JournalManager",
BOOK_METADATA:"book_metaData",BOOK_FRAGMAP:"book_fragmap"},o={},m={};return{CONSTANTS:q.CONSTANTS,DB_CLIENT:q.DB_CLIENT,METRICS_MANAGER:q.METRICS_MANAGER,SERVICE_CLIENT:q.SERVICE_CLIENT,APP_REGISTRATION:q.APP_REGISTRATION,JOURNAL_MANAGER:q.JOURNAL_MANAGER,BOOK_METADATA:q.BOOK_METADATA,BOOK_FRAGMAP:q.BOOK_FRAGMAP,ERROR_CODE_CANCEL:"canceled",registerModule:j,registerModuleList:function(a){for(var c in a)j(c,a[c])},registerModuleWithInitializer:b,registerModuleWithDeferred:function(a,c){b(a,function(a){c.done(a.resolve).fail(a.reject)})},
detachModule:function(a){var c=o[a],b=m[a];b&&!b.isResolved()&&b.reject("canceled");delete o[a];delete m[a];return c},getModule:a,getModuleList:function(b){var c=new jQuery.Deferred,h,d=[];for(h=0;h<b.length;h++)d.push(a(b[h]));$.when.apply($,d).done(function(){var a,h={};for(a=0;a<b.length;a++)h[b[a]]=arguments[a];c.resolve(h)}).fail(c.reject);return c.promise()},getModuleSync:k,isModuleInitialized:function(a){return o[a]!==void 0},isModuleRegistered:function(a){return o.hasOwnProperty(a)},switchToTestMode:function(){this.registerModuleTest=
e;this.getModule=n;this.getModuleSync=k;this.getModuleList=d;this.clear=l;delete this.registerModuleWithDeferred;delete this.registerModuleWithInitializer}}}
var KindleModuleManager=KindleModuleManagerFactory(),KindleRemoteClient=function(){return{getStoreURL:function(){var g=new jQuery.Deferred;$.get("/remote/store").then(function(f){(f=f.url)?g.resolve(f):g.reject()},g.reject);return g.promise()},uploadFeedback:function(g){var f={DevicePlatform:KindleHostDeviceDetector.getDevicePlatform(),UserAgent:navigator.userAgent,WindowHeight:window.innerHeight,WindowWidth:window.innerWidth},g={version:KindleVersion.getDisplayableVersion(),message:g,info:f},g={url:"/remote/feedback",
type:"POST",processData:!1,contentType:"application/json",data:JSON.stringify(g)};return $.ajax(g)}}}(),KindleUserAgentMetricsInfo=function(){var g,f,j,b,a,k={chrome:14,firefox:7,safari:5,ie:9,ios:4};return{browserWithVersionString:function(){if(!g){f=GoogleUserAgent.browserName.toLowerCase();j=GoogleUserAgent.browserVersionString.toLowerCase();var e;["ipad","iphone"].indexOf(f)!==-1&&((e=/CPU OS ([0-9_]+) /.exec(navigator.userAgent))&&e.length>=2&&(j=e[1]),osName=f="ios");a:{if(e=j){var n=/^0*([1-9]+)/.exec(e);
if(n&&n.length>=2){b=parseInt(n[1],10);break a}else KindleDebug.error("Bad regex on versionString: "+e)}b=void 0}"undefined"===typeof b?a="other":k[f]?(e=k[f],n=e+3,a=b<e?[f,"old"].join("@"):b>=n?[f,"new"].join("@"):[f,b].join("@")):a="other";g=!0}return a}}}(),KindleVersion=function(){var g=null;return{getVersion:function(){return"010200011"},getDisplayableVersion:function(){if(!g){var f=parseInt("010200011".slice(0,2),10),j=parseInt("010200011".slice(2,4),10),b=parseInt("010200011".slice(4,6),10),
a=parseInt("010200011".slice(6),10);g=f;g+=".";g+=j;g+=".";g+=b;g+=".";g+=a}return g}}}(),debugLib=function(){function g(a){var c=window.location.href;local=c.slice(0,c.indexOf("/",7));a="[\\?&]"+a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#?]*)";a=RegExp(a).exec(window.location.href);return a===null?null:a[1]}function f(b){var c="";c+=m===!0||m==="true"?"<span style='color:"+a[b[1]]+"'>":"<span style='color:black'>";o===!0&&(c+="<i>// "+b[0]+"</i><br/>");for(var h=b[2];h>0;)c+="-----",h--;
for(h=3;h<b.length;h++)c+=b[h],c+=" ";c+="</span><br/>";e.document.write(c)}var j=null,b=!1,a=["black","#8B0000","#A0522D","#DAA520","green","blue","purple","gray","#708090","#BC8F8F","pink"],k=null,e=null,n=!1,d=[],l=9,q=!0,o=!1,m=!1;return{DEBUG_MESSAGES:void 0,DEBUG_BOXES:void 0,DEBUG_OVERLAY:j,debugMap:function(a,c,h,d,e,f){if(n){if(!b)b=!0,k=a.contentDocument.getElementsByTagName("body")[0],j=document.createElement("DIV"),j.id="pixelDisplay",j.style.top=k.offsetTop+"px",j.style.left=k.offsetLeft+
"px",j.style.width=k.offsetWidth+"px",j.style.height=k.offsetHeight+"px",j.style.position="absolute",k.appendChild(j);a="blue";switch("ALL"){case "YP":a="red";break;case "BLOCKQUOTE":a="white";break;case "DIV":a="red";break;case "YA":a="red";break;case "IMG":a="green";break;case "SUPAN":a="blue";break;case "TAUBLE":a="purple";break;case "TUR":a="teal";break;case "UB":a="pink"}var g=document.createElement("DIV");g.title="Nid: "+d+", starting %: "+e+", # lines: "+f+", top:"+c+", height:"+h;g.style.top=
c+"px";$(g).css("height",h+"px");$(g).css("font-size","0px");g.style.left=k.offsetLeft+"px";g.style.width=k.offsetWidth+"px";g.style.position="absolute";g.style.backgroundColor=a;g.style.opacity=".4";g.style.filter="alpha(opacity=40)";j.appendChild(g)}},resetMap:function(){b=!1},initialize:function(){var a=g("type"),c=g("level");m=g("code");n=Boolean(g("box"));c&&(l=c);a&&(d=a.split(","),e||(a=new Date,e=window.open("","debugLog","width=1000,height=800,scrollbars=yes"),e.document.write("<html>"),
e.document.write("<title>DEBUG LOG</title>"),e.document.write("<body>"),e.document.write("<div id='logChrome' style='width:100%; height:50px; tex-align:center'>"),e.document.write("<br/>"),e.document.write("   <div style='position:absolute; color:black; left:0px; float:left;'>========================== DEBUG "+a+"==========================</div>"),e.document.write("</div>"),e.document.write("</body>"),e.document.write("</html>")),e.focus(),d.length===1?(a=d[0].toUpperCase(),a==="ALL"||a==="*"?o=q=
!0:(o=q=!1,e.document.write("<span style='color:black'>"),e.document.write("//DEBUG: <i>"+a+"</i><br/>"),e.document.write("</span>"))):d.length>1&&(q=!1,o=!0))},debug:function(){var a=arguments;if(!(d.length<1))if(q&&a[1]<=l)f(a);else try{for(var c=a[0].toUpperCase(),b=0;b<d.length;b++){var e=d[b].toUpperCase();c===e&&a[1]<=l&&f(a)}}catch(g){c="";for(b=0;b<a.length;b++)c+="ARG "+b+": ",c+=a[b].toString(),c+=", ";f(["DEBUG ERROR",1,0,"Invalid Debug Statement:",c])}},debugMsg:function(){}}}();debugLib.initialize();
var KindleLibrary=function(){function g(){KindleLibraryHomeScreenPopup.show();KindleLibraryControlBar.setCacheDone()}function f(a){KindleSpinner.hide();a===Kindle.STORE.OFFLINE_ERROR?R(Kindle.ERROR.STORE_OPEN_OFFLINE_FAILED):a===Kindle.STORE.GENERIC_ERROR&&R(Kindle.ERROR.STORE_OPEN_FAILED)}function j(){J||KindleLibraryHeaderBar.deactivateSearch();return!1}function b(){KindleLocalStorage.localStorageObject.getItem(Kindle.App.LIBRARY_FAIL_FLAG)?t.addEvent("Library::OpenLibraryFail"):KindleLocalStorage.localStorageObject.setItem(Kindle.App.LIBRARY_FAIL_FLAG,
"true");w=t.startMetrics("Library::OpenLibrary");KindleSpinner.show();KindleLibrarySetting.initialize();K=KindleHostDeviceDetector.isiPad()||KindleHostDeviceDetector.isPlayBook();u().getBookDataLastSyncTime(o);a();F();x();O();y();KindleLibrarySetting.getLastLibraryView()==="downloaded"&&(KindleLibraryScrollPane.setView("downloaded"),KindleLibrarySetting.setLibraryView("downloaded"));K||B();KindleHostDeviceDetector.isiOS_5x()?$("body",top.document).bind("orientationchange.library",n):$(window).resize(n);
$(window).keydown(d);$(window).keyup(l);$("#slide_container").bind("click",j);$("#page_body").bind("click",j);KindleHostDeviceDetector.isiOS()||$(window).focus(function(){U.checkTokenConsistency()});KindleOffline.isEnabled()?u().getCachedAsins(void 0).then(function(a){var c,b,d={};d[Kindle.BookInfo.CachedState.CACHED]=0;d[Kindle.BookInfo.CachedState.PINNED]=0;for(c in a)b=a[c],d[b.cacheState]++;d[Kindle.BookInfo.CachedState.CACHED]&&t.increaseSubCounter(w,"booksCached",d[Kindle.BookInfo.CachedState.CACHED]);
d[Kindle.BookInfo.CachedState.PINNED]&&t.increaseSubCounter(w,"booksPinned",d[Kindle.BookInfo.CachedState.PINNED])}):t.increaseSubCounter(w,"noOffline",1)}function a(){KindleLibrarySearch.initialize(function(){var a=new jQuery.Deferred;KindleHostDeviceDetector.isOnline()?a.resolve(G):u().getCachedAsins("pinned").done(function(c){var b=[],d;for(d in G)c.indexOf(G[d].asin)<0&&b.push(G[d]);a.resolve(b)});return a.promise()},function(a){a=KindleLibraryScrollPane.showBooks(a);a===0?KindleLibraryMessagePane.showEmptySearchMessage(!KindleHostDeviceDetector.isOnline()):
a>0&&KindleLibraryMessagePane.hideEmptySearchMessage()},function(a){KindleLibraryScrollPane.hideBooks(a)})}function k(){KindleLibraryHeaderBar.setSyncButtonDisabled(!0);KindleSpinner.overlay();u().getBookDataLastSyncTime(o)}function e(){ea=!0;k()}function n(){W?Q=!0:(KindleLibraryContextMenu&&KindleLibraryContextMenu.hide(),KindleLibraryScrollPane.resizeScrollPane())}function d(a){if(!W)switch(a.which){case 38:KindleLibraryScrollBar.moveStart(!0);break;case 40:KindleLibraryScrollBar.moveStart(!1)}}
function l(a){if(!W)switch(a.which){case 33:KindleLibraryScrollBar.movePage(!0);break;case 34:KindleLibraryScrollBar.movePage(!1);break;case 27:KindleLibraryHeaderBar.deactivateSearch();break;default:KindleLibraryScrollBar.moveEnd()}}function q(a){ea?(h(),KindleHostDeviceDetector.isOnline()?R(Kindle.ERROR.SYNC_FAILED):R(Kindle.ERROR.SYNC_FAILED_OFFLINE)):a?u().getAllBooks(c):KindleMessageDialog.showError(Kindle.ERROR.LIBRARY_LOAD_FAILED,function(){o(Kindle.DB.NEVER)},ResourceBundle.getLocalizedString("k4w_dialog_message_retryButton_text"))}
function o(a){var c=a===Kindle.DB.NEVER?null:a;KindleHostDeviceDetector.isOnline()?(w&&c!==null&&t.modifyMetricsMethod(w,"Library::OpenLibraryCached"),U.getOwnedContent(c).then(function(a){ea=!1;u().updateBookData(a.asinsToRemove,a.asinsToAdd,a.syncTime,p,m)},function(){q(c!==null)})):(w&&t.modifyMetricsMethod(w,"Library::OpenLibraryOffline"),q(c!==null))}function m(){KindleLibraryHeaderBar.setSyncButtonDisabled(!1)}function p(a){ea&&a===0?h():u().getAllBooks(function(b){c(b,a===0)})}function c(a,
c){var b=G[0];G=a;for(var d in G)if(G[d].lastTimeRead===void 0)G[d].lastTimeRead=-1;d=KindleLibrarySetting.getLastSortParam();KindleLibrarySort.sortBookList(G,d);KindleLibrarySetting.setSortParam(d);d=G[0];c&&b&&d&&b.asin===d.asin?J&&C(J):(KindleLibraryScrollPane.setLayout(KindleLibrarySetting.getLastLayoutView()),I());h();w&&(t.increaseSubCounter(w,KindleLibrarySetting.getLastLayoutView(),1),t.increaseSubCounter(w,KindleLibrarySetting.getLastLibraryView(),1),t.increaseSubCounter(w,"bookCount",G.length),
t.endMetrics(w),w=void 0)}function h(){ea=!1;J=void 0;KindleSpinner.hide();KindleLibraryHeaderBar.setSyncButtonDisabled(!1);S.onLibraryLoaded();KindleLocalStorage.localStorageObject.removeItem(Kindle.App.LIBRARY_FAIL_FLAG)}function O(){var a=KindleLibrarySetting.getSettings();KindleLibraryScrollPane.initialize(a,r,s,E,v)}function y(){KindleLibraryMessagePane.initialize(function(a){$("#message_container").append(a)},function(){KindleSpinner.show();S.openStore(null,!0)})}function s(a,c){function b(a){var c=
{asin:a,basePath:ga.basePath,useNewPath:ga.useNewPath,useProdBucket:ga.useProdBucket},d=t.startMetrics("Library::SaveBook");KindleOffline.pinBook(c,R).then(function(){t.endMetrics(d);C(a)},function(){t.cancelMetrics(d)})}function d(a){KindleOffline.unpinBook({asin:a},R).done(function(){C(a)})}J||u().getBookCachedState(a.asin).done(function(h){var e=KindleOffline.isEnabled()?KindlePopupMenu.ITEM_ENABLED:KindlePopupMenu.ITEM_DISABLED,f=KindlePopupMenu.ITEM_ENABLED,g=KindlePopupMenu.ITEM_HIDDEN,e=KindleHostDeviceDetector.isOnline()?
e:KindlePopupMenu.ITEM_DISABLED,l=KindleLibrarySetting.getLastLibraryView()==="downloaded"?e:g,k="unknown";if(h&&h.length>0)k=h[0].cacheState;switch(k){case Kindle.BookInfo.CachedState.PINNED:h=[g,l,g,f];break;case Kindle.BookInfo.CachedState.CACHED:h=[e,l,g,f];break;default:h=[g,g,e,f]}KindleLibraryContextMenu.show(a.asin,h,c,[b,d,b,r])})}function E(a,c,b){K||(b>=a?$("#slide_container").removeClass("scrollbar_shown"):($("#slide_container").addClass("scrollbar_shown"),KindleLibraryScrollBar.updateValueRange(a,
c,b)))}function v(a){KindleLibraryScrollBar.updateValue(a)}function P(a){var c=document.createElement("a");c.href=a;c.target="_blank";a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0);c.dispatchEvent(a)}function A(){KindleLibrarySettingsMenu.show(P)}function F(){var a=KindleLibraryHeaderBar,c={},b={},d=KindleLibrarySearch;c[a.EVENT_SYNC_CLICKED]=e;c[a.EVENT_MANAGE_CLICKED]=A;c[a.EVENT_STORE_CLICKED]=function(){KindleSpinner.show();S.openStore(null,!1)};b[a.SEARCH_CALLBACK.ENABLE]=function(){var a=
!KindleHostDeviceDetector.isOnline()?"downloaded":"cloud";KindleLibraryControlBar.hideViewTabs();KindleLibraryScrollPane.setView(a)};b[a.SEARCH_CALLBACK.SEARCH]=function(a){d.search(a)};b[a.SEARCH_CALLBACK.DISABLE]=function(){KindleLibraryScrollPane.setView(KindleLibrarySetting.getLastLibraryView());KindleLibraryControlBar.showViewTabs()};a.initialize(function(a){$("body").append(a)},c,b)}function x(){var a=KindleLibraryControlBar;a.setRetryCallback(L);a.setAppCacheStatusGetter(H.getSharedModuleSync(KindleModuleManager.APPCACHE_EVENTHANDLER).getCacheStatus);
var c={};c[a.EVENT_LIBRARY_SORT_CLICKED]=ba;c[a.EVENT_LIBRARY_LAYOUT_CLICKED]=Y;c[a.EVENT_LIBRARY_IMAGE_CHANGING]=fa;c[a.EVENT_LIBRARY_IMAGE_CHANGED]=X;c[a.EVENT_LIBRARY_VIEW_CLICKED]=T;a.initialize(function(a){$("#page_body_content_containers").prepend(a)},KindleLibrarySetting.getSettings(),c)}function B(){KindleLibraryScrollBar.initialize(function(a){$("#slide_container").append(a)},aa)}function aa(a,c){KindleLibraryScrollPane.setScrollValue(a,c)}function fa(a,c){KindleLibraryScrollPane.updateCoverSize(c.value,
!1)}function X(a,c){var b=c.value;KindleLibrarySetting.setCoverSize(b);KindleLibraryScrollPane.updateCoverSize(b,!0)}function C(a){u().getBookCachedState(a).done(function(c){KindleLibraryScrollPane.updateBookCacheState(a,c.length>0?c[0].cacheState:"");u().getCachedAsins(Kindle.BookInfo.CachedState.FULLY_DOWNLOADED).then(function(a){$.isEmptyObject(a)?KindleLibraryNoDownloadedMessage.show():KindleLibraryNoDownloadedMessage.hide()})})}function I(){u().getCachedAsins(Kindle.BookInfo.CachedState.FULLY_DOWNLOADED).then(function(a){KindleLibraryScrollPane.setBookData(G,
a);G.length===0?KindleLibraryMessagePane.showEmptyLibraryMessage():(KindleLibraryMessagePane.hideEmptyLibraryMessage(),$.isEmptyObject(a)?KindleLibraryNoDownloadedMessage.show():KindleLibraryNoDownloadedMessage.hide())})}function T(a){function c(){KindleLibraryScrollPane.setView(a);KindleLibrarySetting.setLibraryView(a);KindleLibraryControlBar.setViewState(a)}a!==KindleLibrarySetting.getLastLibraryView()&&(!KindleHostDeviceDetector.isOnline()&&a==="cloud"?R("BookNotAvailable"):a==="downloaded"&&!KindleOffline.isEnabled()?
KindleHostDeviceDetector.isFirefox()?KindleOffline.enableOfflineMessage().done(c):KindleOffline.firstRunMessage().done(c):c())}function r(a,c){a!==null&&!W&&(J=a,N=c,KindleHostDeviceDetector.isOnline()?Z(a):u().getBookCachedState(a).done(function(c){c.length>0&&Kindle.BookInfo.CachedState.isMaybeDownloaded(c[0].cacheState)?Z(a):(t.addEvent("Library::OpenBookNotAvailable"),R("BookNotAvailable"),N&&N())}))}function u(){return da.getAppDb()}function Z(a){S.openBook({asin:a,isSample:!1})}function D(){KindleLibraryHeaderBar.deactivateSearch();
N&&N()}function M(){KindleTouchEventsToggler.isRequired()&&KindleTouchEventsToggler.allowTouchEvents();Q&&(KindleLibraryScrollPane.resizeScrollPane(),Q=!1);k();W=!1}function R(a){a===Kindle.ERROR.CONTENT_RENTAL_EXPIRED?ca():KindleMessageDialog.showError(a)}function V(a,c){a?(W=!0,KindleSpinner.hide(),KindleTouchEventsToggler.isRequired()&&KindleTouchEventsToggler.disallowTouchEvents(),setTimeout(D,500)):(R(c),N&&N(),M())}function ba(){var a;a=KindleHostDeviceDetector.isiOS()?"up":"down";KindleLibrarySortMenu.show(a,
function(a){if(a!==KindleLibrarySetting.getLastSortParam())document.getElementById("kindleLibrary_button_sort_label").innerHTML=ResourceBundle.getLocalizedString(KindleLibrarySort.getLabel(a)),G.length>0?(KindleLibrarySort.sortBookList(G,a),KindleLibrarySetting.setSortParam(a),I()):KindleLibrarySetting.setSortParam(a)})}function Y(a){KindleLibraryScrollPane.setLayout(a);KindleLibrarySetting.setLayoutView(a)}function L(){t.addEvent("KindleApp:AppCacheError:RetryClicked",t.BROWSER);KindleLibraryAppCacheFailDialog.hasBeenShownThisSession()?
(KindleLibraryAppCacheFailDialog.open(),t.addEvent("KindleApp:AppCacheError:RetryClickedAfterRebootDialogShown",t.BROWSER)):window.top.location.reload(!1)}function ca(){t.addEvent("Library::Rentals:ExpiredDialogShown");var a=function(){var a=t;return function(){a.addEvent("Library::Rentals:DismissClicked")}}(),c=function(){var a=t,c=J;return function(){a.addEvent("Library::Rentals:BuyOrRentAgainClicked");KindleMessageDialog.close();if(c!==void 0){var b="https://www.amazon.com/dp/"+c+"/ref=kcr_store_expired";
KindleHostDeviceDetector.isiPad()?(b+="_ipad",P(b)):(b+="_desktop",window.top.location=b)}else KindleDebug.error("no asin selected for BuyOrRentAgainClicked")}}();KindleMessageDialog.showError(Kindle.ERROR.CONTENT_RENTAL_EXPIRED,a,ResourceBundle.getLocalizedString("kindle_dialog_rental_expired_dismiss_button_text"),[{buttonText:ResourceBundle.getLocalizedString("kindle_dialog_rental_expired_extend_button_text"),callback:c}])}var G=[],W=!1,J,K,w,N,Q=!1,da=null,H,S,t,U,ea=!1,ga;return{initialize:function(){H=
window.parent.KindleApp;KindleTouchEventsToggler.isRequired()&&KindleTouchEventsToggler.initialize();H&&($("body").bind("touchmove.elastic",KindleIOSScrollStopper.stopScroll),S=H.getAppInterfaceForLibrary(),typeof Kindle==="undefined"&&(Kindle=H.getSharedModuleSync(KindleModuleManager.CONSTANTS)),H.setLibraryInterface({onReaderOpenStatus:V,onReaderClose:M,onStoreOpenStatus:f,libraryUpdateNeeded:k}),H.registerEventCallback(Kindle.APP_CACHE.CACHE_PROGRESS,function(a){KindleLibraryControlBar.setCacheProgress(a.progressRatio)}),
H.registerEventCallback(Kindle.APP_CACHE.CACHE_CACHED,g),H.registerEventCallback(Kindle.APP_CACHE.CACHE_DONE,g),H.registerEventCallback(Kindle.APP_CACHE.CACHE_NEEDS_RETRY,function(){KindleLibraryControlBar.setCacheNeedsRetry()}),H.registerEventCallback(Kindle.APP_CACHE.CACHE_NEEDS_BROWSER_RESTART,function(){KindleLibraryControlBar.setCacheNeedsRetry()}),H.registerEventCallback(Kindle.APP_CACHE.CACHE_NEEDS_BROWSER_RESTART,function(){KindleLibraryAppCacheFailDialog.open()}),H.getSharedModules().done(function(a){KindleModuleManager.registerModuleList(a);
KindleOffline.isFirstTime()&&!H.getQueryParams().asin&&KindleOffline.firstRunMessage();!KindleOffline.isFirstTime()&&!KindleLocalStorage.localStorageObject.getItem("haveDB")&&KindleHostDeviceDetector.isFirefox()&&KindleOffline.enableOfflineMessage();t=a[KindleModuleManager.METRICS_MANAGER];da=a[KindleModuleManager.DB_CLIENT];U=a[KindleModuleManager.SERVICE_CLIENT];b()}),$("body").bind("contextmenu",function(a){a.preventDefault()}),S&&(ga=S.getQueryParameters()))},registerControlHotkey:function(a,
c,b){$(document).keydown(function(d){if(d.keyCode===a.charCodeAt(0)&&(d.ctrlKey||d.metaKey)&&!d.shiftKey)return d.preventDefault(),c.apply(this,b),!1})}}}(),KindleLibraryAuthor=function(){var g=["phd","md","sir"];return{getDisplayableString:function(f){for(var j="",b=f.length,a=0;a<b;a++){for(var k=f[a].split(","),e=[],n=[],d=0;d<k.length;d++){var l=$.trim(k[d]);g.indexOf(l.toLowerCase())>-1?e.push(l):n.unshift(l)}if(n.length===2){j+=n[0]+" "+n[1];for(k=0;k<e.length;k++)j+=", ",j+=e[k]}else j+=f[a];
b>1&&(a===b-2?j+=" and ":a<b-2&&(j+=", "))}return j},getLegacyDisplayableString:function(f){for(var g="",b=f.length,a=0;a<b;a++)g+=f[a],a<b-1&&(g+="; ");return g}}}(),KindleLibraryBookCover=function(){function g(){n||(n=KindleHostDeviceDetector.isiPad()?a:b);return n}function f(a){e||(e=j,e=e.replace("{width}",g().width),e=e.replace("{height}",g().height));var b=e;return b=b.replace("{asin}",a)}var j="/cover/{asin}.01._SX{width}_SY{height}_SCLZZZZZZZ_.jpg",b={width:255,height:255},a={width:255,height:255},
k=null,e=null,n=null;return{getBookCoverUrl:function(a){k||(k="https://images-na.ssl-images-amazon.com/images/P/{asin}.01._SX{width}_SY{height}_SCLZZZZZZZ_.jpg",k=k.replace("{width}",g().width),k=k.replace("{height}",g().height));var b=k;return b=b.replace("{asin}",a)},getOfflineCover:function(a){var b=new jQuery.Deferred,a=f(a);$.ajax({url:a,beforeSend:function(a){a.overrideMimeType("text/plain; charset=x-user-defined")},success:function(a){a="data:image/jpeg;base64,"+KindleO_Aaa.o_aaa(a);b.resolve(a)},
error:b.reject});return b.promise()}}}(),KindleLibraryScrollPane=function(){function g(){B=!0;C&&d()}function f(){for(var c=0;c<H;c++){var b=N[c],d=w[Q+c],h=K[d].find(".book_image");b.height!==1&&b.width!==1?(h.attr("src",b.src),b.width>b.height&&h.removeClass("book_image").addClass("book_image_wide")):T&&(h.attr("src",v),b=K[d].find(".book_title").text(),d=K[d].find(".alt_title"),d.text(b),d.show())}Q+=H;Q>=w.length-1?(N=[],w=[],Q=0):a()}function j(a){return function(){var c=Q+H-1;a>=Q&&a<=c&&(da++,
da===H&&(clearTimeout(S),f()))}}function b(){f()}function a(){da=0;S=setTimeout(b,x);H=Math.min(P,w.length-Q);for(var a=0;a<H;a++){var c=Q+a,d=w[c];N[a]||(N[a]=new Image);c=j(c);N[a].onload=c;N[a].onerror=c;N[a].src=J[d]||KindleLibraryBookCover.getBookCoverUrl(d)}}function k(a){var c=KindleUXComponentManager.renderTemplate(s,{asin:a.asin,title:a.title,author:KindleLibraryAuthor.getDisplayableString(a.authors),src:E}),b=c.find(".book_click_area");b.tap(function(){var b=c.find(".book_image, .book_image_wide");
!Y&&!KindleLibraryContextMenu.isVisible()&&(Y=!0,b.addClass("opening"),L(a.asin,function(){b.removeClass("opening");Y=!1}));return!1});var d=c.find(".book_image, .book_image_wide");T?(c.tapHold(function(c){ca(a,[c.x,c.y-100]);r._unbind("touchmove");r._unbind("touchend");r._unbind("touchcancel")}),b.activate(function(){d.addClass("opening");setTimeout(function(){d.removeClass("opening")},F)})):(b.bind("contextmenu",function(c){t&&clearTimeout(t);ca(a,[c.pageX,c.pageY]);c.preventDefault()}),b.mousedown(function(c){d.addClass("held");
if(!t)U.x=c.pageX,U.y=c.pageY,t=setTimeout(function(){ca(a,[U.x,U.y]);clearTimeout(t);t=null},A)}),b.mouseup(function(){clearTimeout(t);d.removeClass("held");t=null;return!0}),b.mouseout(function(){clearTimeout(t);d.removeClass("held");t=null;return!1}),b.mousemove(function(a){U.x=a.pageX;U.y=a.pageY}));K[a.asin]=c;w.push(a.asin);return c}function e(a,c){var b=K[a];if(b)switch(b.removeClass("book_is_pinned book_is_cached"),c){case Kindle.BookInfo.CachedState.PINNED:b.addClass("book_is_pinned");break;
case Kindle.BookInfo.CachedState.CACHED:b.addClass("book_is_cached")}}function n(){r&&(r.destroy(),r=null);var c=$("<div>").attr("id","titles_inner_wrapper"),b,d,h;for(h in C)b=C[h].asin,d=K[C[h].asin]?K[C[h].asin]:k(C[h]),e(b,I[b]),c.append(d);a();$("#titles_inner_wrapper").replaceWith(c);R=0;o()}function d(){J?n():KindleModuleManager.getModuleSync(KindleModuleManager.DB_CLIENT).getAppDb().getCachedCovers().done(function(a){J=a;n()})}function l(){u=p*fa;X.grid_style_container.style.height=u+c+"px";
X.grid_style_bookCover.style.width=u+"px";X.grid_style_bookCover.style.height=u+"px";X.grid_style_pinned.style.backgroundPosition="center "+(u+3)+"px"}function q(a,c){var b=-c*y;Z&&(b=V.scrollTop()+b,b=Math.min(b,Z-V.height()),b=Math.max(b,0),m(b,!0),W(b))}function o(){T?r?r.refresh():r=KindleLibraryScroller.createScrollerObject("titles_container",{hScroll:!1,lockDirection:!1,hScrollbar:!1,vScrollbar:!1}):(aa==="grid"?(D=u+c,M=Math.floor(V.width()/(u+h)),X.grid_style_container.style.width=100/M+"%"):
(D=O,M=1),m(Math.floor(R/M)*D,!1),Z=V[0].scrollHeight,G(Z,V.scrollTop(),V.height()))}function m(a,c){V.scrollTop(a);c&&(R=Math.round(a/D)*M)}var p=21.25,c=100,h=20,O=86,y=75,s="KindleLibraryBookContainer",E="./images/override/library/img_alt_cover.png",v="./images/override/library/blank_cover.png",P=30,A=1E3,F=500,x=6E4,B,aa,fa,X,C,I,T,r,u,Z,D,M,R=0,V,ba,Y,L,ca,G,W,J,K={},w=[],N=[],Q=0,da=0,H=0,S,t=null,U={x:0,y:0};return{initialize:function(a,c,b,d,h){aa=a.layoutState;fa=a.coverSize;T=KindleHostDeviceDetector.isiOS();
Y=!1;L=c;ca=b;G=d;W=h;V=$("#titles_container");ba=$("#slide_container");a=document.styleSheets[2].cssRules;if(a===void 0)a=document.styleSheets[2].rules;X={};for(c=0;c<a.length;c++){b=a[c];if(b.selectorText===".grid_container .book_container")X.grid_style_container=b;if(b.selectorText===".grid_container .book_cover")X.grid_style_bookCover=b;if(b.selectorText===".grid_container .book_is_pinned")X.grid_style_pinned=b}ba.mousewheel(q);T||l();KindleUXComponentManager.initializeTemplate(s,g)},setBookData:function(a,
c){C=a;I={};for(var b in c)I[c[b].asin]=c[b].cacheState;B&&d()},updateCoverSize:function(a,c){!T&&!c&&(fa=a,l(),o())},setLayout:function(a){aa=a;ba.removeClass("grid_container list_container").addClass(a+"_container");o()},setView:function(a){a==="downloaded"?ba.addClass("download_view"):ba.removeClass("download_view");o()},setScrollValue:m,updateBookCacheState:e,resizeScrollPane:function(){o()},showBooks:function(a){var c=KindleHostDeviceDetector.isOnline(),b=0;$.each(a,function(){$("#"+this.asin).removeClass("hidden");
(c||I[this.asin])&&b++});o();return b},hideBooks:function(a){$.each(a,function(){$("#"+this.asin).addClass("hidden")});o()}}}(),KindleLibraryScroller=function(){function g(f,g){var b=new iScroll(f,g),a=b._momentum;b._momentum=function(b,e,f,d,g){b=b===0?0:Math.max(25,Math.abs(b))*(b<0?-1:1);return a(b,e,f,d,g)};return b}return{createScrollerObject:function(f,j){return new g(f,j)}}}(),KindleLibrarySearch=function(){var g,f,j,b,a,k=-1;return{search:function(e){function n(){var e=l,o=d,m=[],n=[],c=k,
h=k,j,y,s=0,E=0,v;for(v in o)j=o[v],y=KindleLibraryAuthor.getDisplayableString(j.authors),e.source?(c=j.title.search(e),h=y.search(e)):c=0,c!==k||h!==k?(s++,m[s-1]=j):(E++,n[E-1]=j);e=d={matches:m,nonMatches:n};b(e.matches);a(e.nonMatches);g=d.matches;f=l}var d,e=e.replace(RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&"),e=$.trim(e),l=RegExp(e,"i");if(!f||!(f.source&&e===f.source))g&&f&&f.source&&e.search(f)===0?(d=g,n()):j().done(function(a){d=a;n()})},initialize:function(e,f,d){j=e;b=f;a=
d}}}(),KindleLibrarySetting=function(){function g(a){a in c||(c[a]=KindleLocalStorage.localStorageObject.getItem(a));return c[a]}function f(a,b){c[a]=b;return KindleLocalStorage.localStorageObject.setItem(a,b)}function j(){return g(q)}function b(a){f(q,a)}function a(){return g(m)}function k(a){f(m,a)}function e(){return g(p)}function n(a){f(p,a)}function d(){return g(o)}function l(a){f(o,a)}var q="last_layout_view",o="last_opened_view",m="last_sort_param",p="last_cover_size",c={};return{initialize:function(){var c=
j(),f=a(),g=e(),m=d();c||b("grid");f||k("recent");g||n(9);KindleHostDeviceDetector.isOnline()?m||l("cloud"):l("downloaded")},getLastLayoutView:j,setLayoutView:b,getLastSortParam:a,setSortParam:k,getLastCoverSize:e,setCoverSize:n,getLastLibraryView:d,setLibraryView:l,getSettings:function(){var c={};c.layoutState=j();c.viewState=d();c.coverSize=e();c.sortParam=a();return c}}}(),KindleLibrarySort=function(){function g(a){return a.replace(/^[^A-Za-z0-9 ]+/,function(a){return n[a]?a:""})}function f(a){var b;
for(i=0;i<l.length;i++)if(b=l[i],a.indexOf(b)===0)return a.substring(b.length);return a}function j(){var a="[",b;for(b in n)a+=b;return RegExp(a+"]","g")}function b(a){if(!a.sortTitle){var b;d||(d=j());b=g(a.title);b=b.toLowerCase();b=f(b);b=b.replace(d,function(a){return n[a]});a.sortTitle=b}}function a(a,b){return a.sortTitle<b.sortTitle?-1:a.sortTitle>b.sortTitle?1:0}function k(b,d){var e=(d.lastTimeRead>0?d.lastTimeRead:d.purchaseDate)-(b.lastTimeRead>0?b.lastTimeRead:b.purchaseDate);return e===
0?a(b,d):e}function e(b,d){for(var e=0,f=0;f<b.authors.length&&f<d.authors.length&&e===0;f++){var c=b.authors[f].toLowerCase(),h=d.authors[f].toLowerCase();c<h?e=-1:c>h&&(e=1)}e===0&&(e=b.authors.length-d.authors.length);return e===0?a(b,d):e}var n={"\u00e0":"a","\u00c0":"a","\u00e8":"e","\u00c8":"e","\u00ec":"i","\u00cc":"i","\u00f2":"o","\u00d2":"o","\u00f9":"u","\u00d9":"u","\u00e1":"a","\u00c1":"a","\u00e9":"e","\u00c9":"e","\u00ed":"i","\u00cd":"i","\u00f3":"o","\u00d3":"o","\u00fa":"u","\u00da":"u",
"\u00fd":"y","\u00dd":"y","\u00e4":"a","\u00c4":"a","\u00eb":"e","\u00cb":"e","\u00ef":"i","\u00cf":"i","\u00f6":"o","\u00d6":"o","\u00fc":"u","\u00dc":"u","\u00ff":"y","\u00e2":"a","\u00c2":"a","\u00ea":"e","\u00ca":"e","\u00ee":"i","\u00ce":"i","\u00f4":"o","\u00d4":"o","\u00fb":"u","\u00db":"u","\u00e3":"a","\u00c3":"a","\u00f1":"n","\u00d1":"n","\u00e5":"a","\u00c5":"a","\u00f8":"o","\u00d8":"o","\u00e6":"ae","\u00c6":"ae","\u00e7":"c","\u00c7":"c","\u00df":"s"},d,l=["the ","a ","an "];return{SORT_BY_AUTHOR:"author",
SORT_BY_TITLE:"title",SORT_BY_RECENT:"recent",SORT_BY_AUTHOR_LABEL:"k4w_library_sort_author_label",SORT_BY_TITLE_LABEL:"k4w_library_sort_title_label",SORT_BY_RECENT_LABEL:"k4w_library_sort_recent_label",sortBookList:function(d,f){for(var g in d)b(d[g]);switch(f){case "title":d.sort(a);break;case "author":d.sort(e);break;case "recent":d.sort(k);break;default:alert("Trying to sort by invalid type "+f)}},compareBooks:function(d,f,g){b(d);b(f);var l;switch(g){case "recent":l=k(d,f);break;case "title":l=
a(d,f);break;case "author":l=e(d,f);break;default:alert("Trying to compare by invalid type "+g)}return l},getLabel:function(a){switch(a){case "title":return"k4w_library_sort_title_label";case "author":return"k4w_library_sort_author_label";case "recent":return"k4w_library_sort_recent_label";default:return"Invalid Sort Type"}}}}(),KindleDialogOverlay=function(){return{showOverlay:function(g){$("body").append("<div class='ui-widget-overlay ui-widget-overlay-kcr-ios-hack'></div>");$(".ui-widget-overlay-kcr-ios-hack").attr("style",
"z-index: 1000;").width(window.outerWidth).height(window.outerHeight);(function(){var f=g.component.dialog("option","position");$("body",top.document).bind("orientationchange.dialog",function(){g.dialogSettings.k4w_transparent_modal_overlay&&$(".ui-widget-overlay-kcr-ios-hack").css({width:0,height:0});$(".ui-widget-overlay-kcr-ios-hack").css({width:window.outerWidth+"px",height:window.outerHeight+"px"});g.component.dialog("option","position",f)})})();(function(){g.callbacks.onOverlayClicked&&$(".ui-widget-overlay-kcr-ios-hack").tap(function(f){f.preventDefault()})})()},
removeOverlay:function(){$(".ui-widget-overlay-kcr-ios-hack").remove();$("body",top.document).unbind("orientationchange.dialog")}}}(),KindleEnableOfflineDialog=function(){function g(){KindleUXComponentManager.closeDialog(f)}var f="KindleEnableOfflineDialog",j={BUTTON_TEXT:"kindle_dialog_enableOffline_button_text",OFFLINE_TITLE:"kindle_dialog_enable_offline_title",FIREFOX_MSG:"kindle_dialog_enable_offline_firefox_msg"},b={DIALOG:"kindle_dialog_enableOffline",CONTENT:"kindle_dialog_enableOffline_content",
BUTTON:"kindle_dialog_enableOffline_button"},a={TITLE:"enable_offline_title",TOP_MSG:"enable_offline_top_msg"},k,e={getDialogSettings:function(){return{autoOpen:!1,width:626,modal:!0,draggable:!1,resizable:!1,dialogClass:"enableOfflineDialog"}},beforeDialogOpen:function(e){k=e;var d,f;KindleHostDeviceDetector.isFirefox()&&(d=ResourceBundle.getLocalizedString(j.OFFLINE_TITLE),f=ResourceBundle.getLocalizedString(j.FIREFOX_MSG));e={title:d,topInstruction:f,topInstructionClass:void 0};k.find("#"+a.TITLE).html(e.title);
k.find("#"+a.TOP_MSG).html(e.topInstruction);e.topInstructionClass&&k.find("#"+a.TOP_MSG).addClass(e.topInstructionClass);e=k.find("#"+b.BUTTON);e.html(ResourceBundle.getLocalizedString(j.BUTTON_TEXT));e.one("click",g)},onDialogOpen:function(){var a=$("#"+b.DIALOG);a.parents(".ui-dialog:first").removeClass("ui-widget ui-widget-content ui-corner-all");a.removeClass("ui-dialog-content ui-widget-content")}};return{open:function(){KindleUXComponentManager.openDialog(f,e)},close:function(){KindleUXComponentManager.closeDialog(f)}}}(),
KindleFirstRunDialog=function(){function g(){KindleUXComponentManager.closeDialog(j);n()}function f(){var a,d,e,c,h;KindleHostDeviceDetector.isChromeApp()?(d=ResourceBundle.getLocalizedString(b.CHROME_APP_TITLE),e=ResourceBundle.getLocalizedString(b.CHROME_APP_MSG)):KindleHostDeviceDetector.isChrome()?(c="continue",d=ResourceBundle.getLocalizedString(b.OFFLINE_TITLE),e=ResourceBundle.getLocalizedString(b.CHROME_MSG)):KindleHostDeviceDetector.isiOS()?(a="ipad_prompt",d=ResourceBundle.getLocalizedString(b.OFFLINE_TITLE),
e=ResourceBundle.getLocalizedString(b.IOS_PROMPT_MSG)):KindleHostDeviceDetector.isFirefox()?(a="ff_prompt",d=ResourceBundle.getLocalizedString(b.OFFLINE_TITLE),e=ResourceBundle.getLocalizedString(b.FIREFOX_MSG),h="ff-db-msg"):(a="safari_prompt",d=ResourceBundle.getLocalizedString(b.OFFLINE_TITLE),e=ResourceBundle.getLocalizedString(b.SAFARI_PROMPT_MSG));return{topImgClass:a,title:d,topInstruction:e,bottomImgClass:c,topInstructionClass:h}}var j="KindleFirstRunDialog",b={BUTTON_TEXT:"kindle_dialog_firstRun_button_text",
BUTTON_TEXT_CHROME:"kindle_dialog_firstRun_button_text_chrome",CRX_BUTTON_TEXT:"kindle_dialog_firstRun_button_crx_text",INSTALLING_BUTTON_TEXT:"kindle_dialog_firstRun_button_installing_text",INSTALLED_BUTTON_TEXT:"kindle_dialog_firstRun_button_installed_text",CONTINUE_BUTTON_TEXT:"kindle_dialog_firstRun_button_text_chrome_done",OFFLINE_TITLE:"kindle_dialog_firstRun_offline_title",CHROME_APP_TITLE:"kindle_dialog_firstRun_chrome_app_title",CHROME_APP_MSG:"kindle_dialog_firstRun_chrome_app_msg",CHROME_MSG:"kindle_dialog_firstRun_chrome_msg",
FIREFOX_MSG:"kindle_dialog_firstRun_firefox_msg",IOS_PROMPT_MSG:"kindle_dialog_firstRun_ios_prompt_msg",SAFARI_PROMPT_MSG:"kindle_dialog_firstRun_safari_prompt_msg"},a={DIALOG:"kindle_dialog_firstRun",CONTENT:"kindle_dialog_firstRun_content",BUTTON:"kindle_dialog_firstRun_button",CRX_BUTTON:"kindle_dialog_firstRun_button_crx"},k={TITLE:"first_run_title",TOP_MSG:"first_run_top_msg",TOP_IMG:"first_run_top_img",BOTTOM_IMG:"first_run_bottom_img"},e="/static/crx/001/kcr-chrome.crx",n,d,l,q={getDialogSettings:function(){return{autoOpen:!1,
width:626,modal:!0,draggable:!1,resizable:!1,dialogClass:"firstRunDialog"}},beforeDialogOpen:function(j){function m(){h.addClass("disabled");h.html(ResourceBundle.getLocalizedString(b.INSTALLING_BUTTON_TEXT));l=window.setInterval(n,500);window.location.replace(e)}function n(){KindleHostDeviceDetector.isChromeApp()&&(window.clearInterval(l),c.addClass("main").html(ResourceBundle.getLocalizedString(b.CONTINUE_BUTTON_TEXT)),h.html(ResourceBundle.getLocalizedString(b.INSTALLED_BUTTON_TEXT)))}d=j;j=f();
d.find("#"+k.TITLE).html(j.title);d.find("#"+k.TOP_MSG).html(j.topInstruction);j.topImgClass&&d.find("#"+k.TOP_IMG).addClass(j.topImgClass);j.bottomImgClass&&d.find("#"+k.BOTTOM_IMG).addClass(j.bottomImgClass);j.topInstructionClass&&d.find("#"+k.TOP_MSG).addClass(j.topInstructionClass);var c=d.find("#"+a.BUTTON);c.html(ResourceBundle.getLocalizedString(b.BUTTON_TEXT));c.one("click",g);if(KindleHostDeviceDetector.isChrome()&&!KindleHostDeviceDetector.isChromeApp()){c.removeClass("primary_btn").addClass("chrome_btn").html(ResourceBundle.getLocalizedString(b.BUTTON_TEXT_CHROME));
var h=d.find("#"+a.CRX_BUTTON);h.removeClass("disabled").html(ResourceBundle.getLocalizedString(b.CRX_BUTTON_TEXT));h.one("click",m);h.show()}},onDialogOpen:function(){var b=$("#"+a.DIALOG);b.parents(".ui-dialog:first").removeClass("ui-widget ui-widget-content ui-corner-all");b.removeClass("ui-dialog-content ui-widget-content")},onDialogClose:function(){l&&window.clearInterval(l)}};return{open:function(a){n=a;KindleUXComponentManager.openDialog(j,q)},close:function(){KindleUXComponentManager.closeDialog(j)}}}(),
KindleMessageDialog=function(){var g={TITLE_ID:"kindle_dialog_message_title_text",TEXT_ID:"kindle_dialog_message_text"},f,j={dismiss:"k4w_dialog_message_dismissButton_text"},b,a,k,e,n=function(){KindleUXComponentManager.closeDialog("KindleMessageDialog")},d={getDialogSettings:function(){return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,k4w_transparent_modal_overlay:!0}},beforeDialogOpen:function(b){var d={};e?d[e]=n:d[ResourceBundle.getLocalizedString(j.dismiss)]=n;if(_additionalButtons)for(var f=
0;f<_additionalButtons.length;f++){var l=_additionalButtons[f];d[l.buttonText]=l.callback}b.dialog("option","buttons",d);b.find("#"+g.TITLE_ID).empty().append(k);b.find("#"+g.TEXT_ID).empty().append(a)},onDialogClose:function(){b&&b()}},l=function(f,g,l,n,c){b=l;k=f;a=g;_additionalButtons=c;e=n?n:ResourceBundle.getLocalizedString(j.dismiss);KindleUXComponentManager.openDialog("KindleMessageDialog",d)};return{open:l,close:n,showError:function(a,b,d,e){f||(f={},f[Kindle.ERROR.OUT_OF_SPACE]="k4w_library_saveBookOutOfSpace",
f[Kindle.ERROR.TIMEOUT]="k4w_library_openBookTimeoutError",f[Kindle.ERROR.LOAD_FAILURE]="k4w_library_openBookLoadFailure",f[Kindle.ERROR.REMOVE_FAILURE]="k4w_library_removeBookError",f[Kindle.ERROR.REMOVE_NETWORK_FAILURE]="k4w_library_removeBookNetworkError",f[Kindle.ERROR.BOOKEXTRAS_OPEN_FAILED]="k4w_bookextras_open_failed_Error",f[Kindle.ERROR.BOOKEXTRAS_NO_CACHE_ERROR]="k4w_bookextras_offline_cache_failed_Error",f[Kindle.ERROR.CONTENT_LOANED]="k4w_library_openBookContentLoanedError",f[Kindle.ERROR.CONTENT_LOAN_ENDED]=
"k4w_library_openBookContentLoanEndedError",f[Kindle.ERROR.CONTENT_LICENSE_EXCEEDED]="k4w_library_openBookContentLicenseExceededError",f[Kindle.ERROR.CONTENT_UNSUPPORTED]="k4w_library_openBookContentUnsupportedError",f[Kindle.ERROR.CONTENT_RENTAL_EXPIRED]="k4w_library_openBookContentRentalExpiredError",f[Kindle.ERROR.SESSION_LIMIT_EXCEEDED]="k4w_library_openBookSessionLimitExceededError",f[Kindle.ERROR.BOOK_NOT_AVAILABLE]="k4w_library_bookNotAvailable",f[Kindle.ERROR.STORE_NOT_AVAILABLE]="k4w_library_storeNotAvailable",
f[Kindle.ERROR.STORE_OPEN_FAILED]="k4w_store_open_failed_Error",f[Kindle.ERROR.STORE_OPEN_OFFLINE_FAILED]="k4w_store_open_failed_offline_Error",f[Kindle.ERROR.SYNC_FAILED]="k4w_library_syncFailedError",f[Kindle.ERROR.SYNC_FAILED_OFFLINE]="k4w_library_syncFailedOfflineError",f[Kindle.ERROR.NOT_IMPLEMENTED]="k4w_library_unimplementedFeature_Error",f[Kindle.ERROR.LIBRARY_LOAD_FAILED]="k4w_library_loadFailedError",f[Kindle.ERROR.NETWORK]="k4w_library_openBookNetworkError",f[Kindle.ERROR.UNKNOWN_ERR]=
"k4w_library_unknownError");(a=f[a])||(a=f[Kindle.ERROR.UNKNOWN_ERR]);l(ResourceBundle.getLocalizedString(a+"_Title"),ResourceBundle.getLocalizedString(a+"_Text"),b,d,e)}}}(),KindlePopupMenu=function(){function g(a){var c=KindleUXComponentManager.renderTemplate(b),e=c.find("#kindle_menu_border"),g=o[a].menuItems,k=!0,m,E;for(E in g)m=$(document.createElement("div")).addClass(n).addClass(d).text(E),k&&(m.addClass(l),k=!1),m.tap(f(m,g[E])),e.append(m);m.addClass(q);KindleHostDeviceDetector.isiOS()&&
"onorientationchange"in window&&$("body",top.document).bind("orientationchange",function(){KindleUXComponentManager.hideMenu(a)});o[a].doneCallback(c,j(a))}function f(a,c){return function(){a.hasClass(d)&&c()}}function j(b){return{getDialogSettings:function(){var c=a,d=o[b];d.buttonID&&(c+=" "+(d.position==="down"?k:e));return{autoOpen:!1,draggable:!1,resizable:!1,modal:!0,minHeight:0,width:"auto",dialogClass:c,k4w_transparent_modal_overlay:!0}},beforeDialogOpen:function(a){var d=o[b].buttonID,e=
o[b].position,f=[];d?(d=$("#"+d),e==="down"?(f[0]=d.offset().left,f[1]=d.offset().top+d.outerHeight()):(f[0]="right",f[1]="bottom")):f=e;a.dialog("option","position",f)},onDialogOpen:function(){m=!0},onDialogClose:function(){m=!1},onOverlayClicked:function(){m&&KindleUXComponentManager.hideMenu(b)}}}var b="KindlePopupMenu",a="kindle_menu",k="down_menu",e="up_menu",n="kindle_menu_button",d="button_enabled",l="ui-corner-top",q="ui-corner-bottom",o={},m=!1;return{ITEM_ENABLED:0,ITEM_DISABLED:1,ITEM_HIDDEN:2,
initialize:function(a,c,d,e,f){o[a]={menuItems:d,doneCallback:f,buttonID:c,position:e};KindleUXComponentManager.hasTemplate(b)?g(a):KindleUXComponentManager.initializeTemplate(b,function(){g(a)})},updateMenu:function(a,c){for(var b,e,f=0;f<c.length;f++)c[f]!==2&&(b===void 0&&(b=f),e=f);a.find("."+n).each(function(a){$(this).removeClass().addClass(n);switch(c[a]){case 0:$(this).addClass(d);break;case 1:$(this).addClass("button_disabled");break;case 2:$(this).addClass("button_hidden")}a===b&&$(this).addClass(l);
a===e&&$(this).addClass(q)})},updatePosition:function(a,c){o[a].position=c}}}(),KindlePromptDialog=function(){var g={TEXT_LABEL_STRING_ID:"k4w_reader_syncPosition_labelText",OK_BUTTON_STRING_ID:"k4w_common_confirm_button",CANCEL_BUTTON_STRING_ID:"k4w_common_cancel_button"},f={TEXT_LABEL_ID:"kindle_dialog_prompt_label"},j,b,a,k=function(){a="ok";KindleUXComponentManager.closeDialog("KindlePromptDialog")},e=function(){a="cancel";KindleUXComponentManager.closeDialog("KindlePromptDialog")},n={getDialogSettings:function(){var a=
{};a[ResourceBundle.getLocalizedString(g.CANCEL_BUTTON_STRING_ID)]=e;a[ResourceBundle.getLocalizedString(g.OK_BUTTON_STRING_ID)]=k;return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,buttons:a,k4w_transparent_modal_overlay:!0}},beforeDialogOpen:function(a){var e=ResourceBundle.getLocalizedString(b);a.find("#"+f.TEXT_LABEL_ID).empty().append(e)},onDialogClose:function(){j(a)}};return{open:function(d,e){j=e;a=!1;b=d;KindleUXComponentManager.openDialog("KindlePromptDialog",n)}}}(),KindleSigningOutDialog=
function(){var g={getDialogSettings:function(){return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,width:"450px"}}};return{show:function(){KindleUXComponentManager.openDialog("KindleSigningOutDialog",g)},hide:function(){KindleUXComponentManager.closeDialog("KindleSigningOutDialog")}}}(),KindleSpinner=function(){function g(){k||(k=new jQuery.Deferred,KindleUXComponentManager.initializeComponent(b,f));return k.promise()}function f(b){a=b;$("body").append(a);k.resolve()}function j(){var b=window.innerWidth>
1?window.innerWidth:window.outerWidth,f=parseInt(a.css("width"),10),d=window.outerHeight,g=parseInt(a.css("height"),10);a.css("top",(d-g)/2+"px").css("left",(b-f)/2+"px").show()}var b="KindleSpinner",a,k;return{overlay:function(){var a=g();$.when(a).then(function(){j()})},show:function(){var a=g();$.when(a).then(function(){j()})},hide:function(){var b=g();$.when(b).then(function(){a.hide()})}}}(),KindleUnoptimizedFormatDialog=function(){var g={TEXT_LABEL_STRING_ID:"k4w_reader_dialog_unoptimizedFormat_message",
CLOSE_BUTTON_STRING_ID:"k4w_reader_dialog_unoptimizedFormat_close",STOP_BUTTON_STRING_ID:"k4w_reader_dialog_unoptimizedFormat_stopSave",CONTINUE_BUTTON_STRING_ID:"k4w_reader_dialog_unoptimizedFormat_continue"},f={TEXT_LABEL_ID:"k4w_reader_dialog_unoptimizedFormat_message_id"},j,b,a,k=function(){KindleUXComponentManager.closeDialog("KindleUnoptimizedFormatDialog")},e=function(){b=!0;KindleUXComponentManager.closeDialog("KindleUnoptimizedFormatDialog")},n={getDialogSettings:function(){var a={};a[ResourceBundle.getLocalizedString(g.CLOSE_BUTTON_STRING_ID)]=
k;a[ResourceBundle.getLocalizedString(g.CONTINUE_BUTTON_STRING_ID)]=e;return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,buttons:a,k4w_transparent_modal_overlay:!0}},beforeDialogOpen:function(b){var e=ResourceBundle.getLocalizedString(g.TEXT_LABEL_STRING_ID);b.find("#"+f.TEXT_LABEL_ID).empty().append(e);$(b[0].parentNode).find(".ui-button-text").first().text(a)},onDialogClose:function(){j(b)}};return{open:function(d){a=ResourceBundle.getLocalizedString(g.CLOSE_BUTTON_STRING_ID);j=d;b=!1;KindleUXComponentManager.openDialog("KindleUnoptimizedFormatDialog",
n)},openPinning:function(d){a=ResourceBundle.getLocalizedString(g.STOP_BUTTON_STRING_ID);j=d;b=!1;KindleUXComponentManager.openDialog("KindleUnoptimizedFormatDialog",n)}}}(),KindleLibraryAppCacheFailDialog=function(){function g(){KindleUXComponentManager.closeDialog(f)}var f="KindleLibraryAppCacheFailDialog",j={DIALOG:"kindle_dialog_appCacheFail",IMG_ARROW_ID:"appCacheDialogFail_arrow",CONTENT_TEXT_ID:"appCacheDialogFail_content",TOGGLER_ID:"appCacheDialogFail_toggler",BUTTON:"kindle_appCacheDialog_button"},
b=!1,a=!1,k,e={onDialogOpen:function(a){var d=$("#"+j.DIALOG);d.parents(".ui-dialog:first").removeClass("ui-widget ui-widget-content ui-corner-all");d.removeClass("ui-dialog-content ui-widget-content");b=!0;a.dialog("option","position","center")},getDialogSettings:function(){return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,width:626,position:"center",k4w_transparent_modal_overlay:!0}},onInitializationDone:function(b){k=KindleModuleManager.getModuleSync(KindleModuleManager.METRICS_MANAGER);b.find("#"+
j.BUTTON).bind("click",g);var d=b.find("#"+j.TOGGLER_ID),e=b.find("#"+j.IMG_ARROW_ID),f=b.find("#"+j.CONTENT_TEXT_ID);d.tap(function(){f.slideToggle("fast",function(){b.dialog("option","position","center")});e.hasClass("kindleLibrary_arrowClosed")?e.switchClass("kindleLibrary_arrowClosed","kindleLibrary_arrowOpen",0):e.switchClass("kindleLibrary_arrowOpen","kindleLibrary_arrowClosed",0);a||k.addEvent("KindleApp:AppCacheError:BrowserRebootPrompt:ExpandClicked",k.BROWSER);a=!0})}};return{hasBeenShownThisSession:function(){return b},
open:function(){KindleUXComponentManager.openDialog(f,e)},close:g}}(),KindleLibraryContextMenu=function(){function g(a){return function(){f();a(b)}}function f(){KindleUXComponentManager.hideMenu(j)}var j="KindleLibraryContextMenu",b,a,k=["k4w_library_context_pin","k4w_library_context_remove","k4w_library_context_download_pin","k4w_library_context_read"];return{isVisible:function(){return KindleUXComponentManager.isVisible(j)},show:function(e,f,d,l){b=e;a={};for(e=0;e<k.length;e++)a[ResourceBundle.getLocalizedString(k[e])]=
g(l[e]);KindleUXComponentManager.showMenu(j,null,a,d,f)},hide:f}}(),KindleLibraryControlBar=function(){function g(a,c){var b=x.find("#"+a).children(),d,e;for(d=0;d<b.length;d++)e=b[d].id,e===c?$(b[d]).addClass(A.ACTIVE):$(b[d]).removeClass(A.ACTIVE)}function f(a,c,b){var d=a.find("#"+c);d.tap(function(){if(b)return b(d[0]),!1})}function j(j){x=j;x.find("#view_"+l).addClass(A.ACTIVE);x.find("#view_"+q).addClass(A.ACTIVE);var m=n[p],o=n[y],s=n[c];f(j,v.VIEW_GRID_ID,function(a){g(v.LAYOUT_BUTTONS_ID,
v.VIEW_GRID_ID);B&&B.show();m(a.getAttribute("value"))});f(j,v.VIEW_LIST_ID,function(a){g(v.LAYOUT_BUTTONS_ID,v.VIEW_LIST_ID);B&&B.hide();m(a.getAttribute("value"))});f(j,v.SORT_BUTTON_ID,function(){s()});$.each(v.VIEW,function(a,c){f(j,c,function(a){!KindleHostDeviceDetector.isOnline()&&a.id===v.VIEW.CLOUD_ID||!KindleOffline.isEnabled()&&a.id===v.VIEW.DOWNLOAD_ID||g(v.VIEW_BUTTONS_ID,a.id);o(a.getAttribute("value"))})});switch(E()){case Kindle.APP_CACHE.CACHE_NEEDS_BROWSER_RESTART:a();break;case Kindle.APP_CACHE.CACHE_NEEDS_RETRY:a();
break;case Kindle.APP_CACHE.CACHE_PROGRESS:b(aa);break;case Kindle.APP_CACHE.CACHE_CACHED:k();break;case Kindle.APP_CACHE.CACHE_DONE:k()}if(KindleHostDeviceDetector.isiOS())e(j);else{B=KindleLibraryImageSlider;var T={};T[B.EVENT_LIBRARY_IMAGE_CHANGING]=n[h];T[B.EVENT_LIBRARY_IMAGE_CHANGED]=n[O];B.initialize(function(a){a.insertAfter(x.find("#"+v.VIEW_TOGGLE_ID));e(j)},d,l,T)}}function b(a){aa=a;x&&x.addClass(A.CACHING)}function a(){if(x){x.removeClass(A.CACHE_SUCCESS).addClass(A.CACHE_ERROR);var a=
KindleHostDeviceDetector.isiPad()?P.CACHE_ERROR_MESSAGE_PAD:P.CACHE_ERROR_MESSAGE;x.find("#"+v.MESSAGE_ID).empty().append(ResourceBundle.getLocalizedString(a)).tap(s)}}function k(){x&&(x.find("#"+v.MESSAGE_ID).empty().append(ResourceBundle.getLocalizedString(P.CACHE_DONE_MESSAGE)),x.removeClass(A.CACHE_ERROR).addClass(A.CACHE_SUCCESS),setTimeout(function(){x.removeClass(A.CACHING)},F))}var e,n,d,l,q,o,m=0,p=m++,c=m++,h=m++,O=m++,y=m++,s,E,v={VIEW_GRID_ID:"view_grid",VIEW_LIST_ID:"view_list",SORT_BUTTON_ID:"kindleLibrary_button_sort",
VIEW:{DOWNLOAD_ID:"view_downloaded",CLOUD_ID:"view_cloud"},VIEW_BUTTONS_ID:"view_state_buttons",CONTAINER_ID:"view_sort_size_controls",LAYOUT_BUTTONS_ID:"view_buttons",SORT_BUTTONS_ID:"view_sort",VIEW_TOGGLE_ID:"view_toggle",MESSAGE_ID:"cache_message"},P={CACHE_MESSAGE:"k4w_library_caching",CACHE_DONE_MESSAGE:"k4w_library_cached",CACHE_ERROR_MESSAGE:"k4w_library_cacheError",CACHE_ERROR_MESSAGE_PAD:"k4w_library_cacheError_pad"},A={ACTIVE:"btn_set_active",CACHING:"caching",CACHE_ERROR:"cacheError",
CACHE_SUCCESS:"cacheSuccess"},F=3E3,x,B,aa=1;return{EVENT_LIBRARY_LAYOUT_CLICKED:p,EVENT_LIBRARY_SORT_CLICKED:c,EVENT_LIBRARY_IMAGE_CHANGING:h,EVENT_LIBRARY_IMAGE_CHANGED:O,EVENT_LIBRARY_VIEW_CLICKED:y,CONTAINER_HEIGHT:45,initialize:function(a,c,b){e=a;n=b;d=c.coverSize;l=c.layoutState;q=c.viewState;o=c.sortParam;KindleModuleManager.getModuleSync(KindleModuleManager.METRICS_MANAGER);a=ResourceBundle.getLocalizedString(KindleLibrarySort.getLabel(o));KindleUXComponentManager.initializeComponent("KindleLibraryControlBar",
j,{sortParam:a})},setViewState:function(a){q=a;g(v.VIEW_BUTTONS_ID,"view_"+a)},setCacheProgress:b,setCacheNeedsRetry:a,setCacheDone:k,setRetryCallback:function(a){s=a},setAppCacheStatusGetter:function(a){E=a},hideViewTabs:function(){$("#page_body").addClass("search_mode",200)},showViewTabs:function(){$("#page_body").removeClass("search_mode",200)}}}(),KindleLibraryFeedbackDialog=function(){function g(){KindleUXComponentManager.closeDialog(j)}function f(){var b=e.find("#"+a).val();if(b){e.find("#"+
a);var f=e.find("#"+k);f.addClass("sending").removeClass("success error");f.html(ResourceBundle.getLocalizedString("k4w_provide_feedback_sending"));KindleRemoteClient.uploadFeedback(b).then(function(){f.removeClass("sending error").addClass("success");f.html(ResourceBundle.getLocalizedString("k4w_provide_feedback_success"));setTimeout(function(){KindleUXComponentManager.closeDialog(j)},1500)},function(){f.removeClass("success sending").addClass("error");f.html(ResourceBundle.getLocalizedString("k4w_provide_feedback_error"))})}else KindleUXComponentManager.closeDialog(j)}
var j="KindleLibraryFeedbackDialog",b={DIALOG_SEND_FEEDBACK_BTN_ID:"k4w_send_feedback_button",DIALOG_CANCEL_BTN_ID:"k4w_common_cancel_button"},a="kindleLibrary_feedback_area",k="kindleLibrary_feedback_status",e,n={onInitializationDone:function(b){e=b;b.click(function(a){a.stopPropagation()});KindleTouchEventsToggler.isRequired()&&(e.find("#"+a).focus(function(){KindleTouchEventsToggler.off()}),e.find("#"+a).blur(function(){KindleTouchEventsToggler.on()}))},getDialogSettings:function(){var a={};a[ResourceBundle.getLocalizedString(b.DIALOG_CANCEL_BTN_ID)]=
g;a[ResourceBundle.getLocalizedString(b.DIALOG_SEND_FEEDBACK_BTN_ID)]=f;return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,buttons:a,k4w_transparent_modal_overlay:!0}},beforeDialogOpen:function(){e.find("#"+k).html("");e.find("#"+a).val("")}};return{show:function(){KindleUXComponentManager.openDialog(j,n)}}}(),KindleLibraryHeaderBar=function(){function g(a,b){a.find("#"+c[b]).tap(function(){var a=A[h[b]];a&&a();return!1})}function f(b){F=b;x=$(b.find("#"+c.SYNC_BUTTON_ID)[0]);var d=A[h.SYNC_BUTTON_ID];
A[h.SYNC_BUTTON_ID]=function(){B||d()};b.find(":not(.search)").click(function(){E&&a()});var e=b.find("#"+c.SEARCH_BAR_ID),f=b.find("#"+c.CLEAR_BUTTON_ID);e.keydown(function(a){a.keyCode===13&&a.preventDefault()});KindleLibrary.registerControlHotkey("F",j);e.keyup(function(){var a=e.attr("value");if(s[y.SEARCH])s[y.SEARCH](a);a&&!v?f.fadeIn(200):!a&&v&&f.fadeOut(420);v=a});A[h.CLEAR_BUTTON_ID]=k;b.find("#"+c.SEARCH_BUTTON_ID).click(j);b.find("#"+c.CLEAR_BUTTON_ID).click(k);for(var l in c)c[l]===c.SEARCH_BUTTON_ID||
c[l]===c.SEARCH_BAR_ID||c[l]===c.CLEAR_BUTTON_ID||g(b,l);KindleTouchEventsToggler.isRequired()&&(e.focus(function(){KindleTouchEventsToggler.off(function(a){return a&&($(a).hasClass("book_container")||$(a).hasClass("book_click_area"))?!0:!1})}),e.blur(function(){KindleTouchEventsToggler.on()}));P(b)}function j(){E?a():b()}function b(){var a=$("#"+c.SEARCH_BAR_ID),b=$("#"+c.SEARCH_BUTTON_ID);E=!0;if(s[y.ENABLE])s[y.ENABLE]();a.show();a.attr("disabled","");a.focus();a.css("opacity",100);a.hide();b.fadeOut(150,
function(){b.removeClass("header_bar_icon large");b.addClass("small");b.fadeIn(100);a.fadeIn(420,function(){if(s[y.SEARCH])s[y.SEARCH]("")})})}function a(){if(E){var a=$("#"+c.SEARCH_BAR_ID),b=$("#"+c.SEARCH_BUTTON_ID);a.blur();document.activeElement.blur();window.focus();E=!1;k();if(s[y.DISABLE])s[y.DISABLE]();a.fadeOut(333,function(){a.attr("disabled","disabled");a.css("opacity",0);b.hide();b.removeClass("small");b.addClass("header_bar_icon large");b.fadeIn(150);document.activeElement.blur()})}}
function k(){$("#"+c.SEARCH_BAR_ID).attr("value","");v="";$("#"+c.CLEAR_BUTTON_ID).fadeOut(420);E&&$("#"+c.SEARCH_BAR_ID).focus();if(s[y.SEARCH])s[y.SEARCH]("")}var e=0,n=e++,d=e++,l=e++,q=e++,o=e++,m=e++,p=e++,c={KINDLE_LOGO_ID:"kindleLibrary_kindleLogo",SEARCH_BUTTON_ID:"kindleLibrary_button_search",SYNC_BUTTON_ID:"kindleLibrary_button_sync",MANAGE_BUTTON_ID:"kindleLibrary_button_manage",STORE_BUTTON_ID:"kindleLibrary_button_store",SEARCH_BAR_ID:"kindleLibrary_bar_search",CLEAR_BUTTON_ID:"kindleLibrary_clear_search"},
h={KINDLE_LOGO_ID:n,SEARCH_BUTTON_ID:d,SEARCH_BAR_ID:l,CLEAR_BUTTON_ID:q,SYNC_BUTTON_ID:o,MANAGE_BUTTON_ID:m,STORE_BUTTON_ID:p},e=0,q=e++,O=e++,e=e++,y={ENABLE:q,SEARCH:O,DISABLE:e},s,E=!1,v="",P,A,F,x,B=!1;return{EVENT_LOGO_CLICKED:n,EVENT_SEARCH_CLICKED:d,EVENT_BAR_CLICKED:l,EVENT_SYNC_CLICKED:o,EVENT_MANAGE_CLICKED:m,EVENT_STORE_CLICKED:p,SEARCH_CALLBACK:y,initialize:function(a,c,b){P=a;A=c;s=b;KindleUXComponentManager.initializeComponent("KindleLibraryHeaderBar",f)},setSyncButtonDisabled:function(a){F&&
(a?x.addClass("disabled"):x.removeClass("disabled"),B=a)},activateSearch:b,deactivateSearch:a,clearSearch:k}}(),KindleLibraryImageSlider=function(){function g(){l&&l.hide()}function f(e){l=e;var f=a[n],p=a[d],c=l.find("#"+q.IMAGE_SLIDER_ID);c.slider({range:"min",value:j,max:12,min:6,step:1,animate:!0,slide:f,change:p});c.find(".ui-slider-handle").removeAttr("href");b==="list"&&g();k(e)}var j,b,a,k,e=0,n=e++,d=e++,l,q={IMAGE_SLIDER_ID:"kindleLibrary_coverImage_slider"};return{EVENT_LIBRARY_IMAGE_CHANGING:n,
EVENT_LIBRARY_IMAGE_CHANGED:d,initialize:function(d,e,g,c){k=d;b=g;a=c;j=e;KindleUXComponentManager.initializeComponent("KindleLibraryImageSlider",f)},show:function(){l&&l.show()},hide:g}}(),KindleLibraryMessagePane=function(){function g(g){e=!1;g.find(f.EMPTY_LIBRARY_MESSAGE).tap(function(){k();return!0});var d=ResourceBundle.getLocalizedString(b.EMPTY_SEARCH_MSG);g.find("#"+f.EMPTY_SEARCH_TEXT).text(d);d=ResourceBundle.getLocalizedString(b.EMPTY_SEARCH_OFFLINE);g.find("#"+f.EMPTY_SEARCH_DETAIL).text(d);
d=$(document.createElement("span")).addClass(j.EMPTY_LIBRARY_STORENAME).text(ResourceBundle.getLocalizedString(b.EMPTY_LIBRARY_STORE_NAME)).wrap("<div>").parent().html();d=ResourceBundle.getLocalizedString(b.EMPTY_LIBRARY_MSG,[d]);g.find(f.EMPTY_LIBRARY_MAIN).html(d);a(g)}var f={EMPTY_LIBRARY_MESSAGE:"#empty-lib-box",EMPTY_LIBRARY_MAIN:"#empty-lib-box p.main",EMPTY_SEARCH_BOX:"#empty_search_box",EMPTY_SEARCH_TEXT:"#empty_search_text",EMPTY_SEARCH_DETAIL:"#empty_search_detail"},j={EMPTY_LIBRARY_STORENAME:"store-name"},
b={EMPTY_SEARCH_MSG:"empty_search_msg",EMPTY_SEARCH_OFFLINE:"empty_search_offline",EMPTY_LIBRARY_MSG:"k4w_empty_library_main",EMPTY_LIBRARY_STORE_NAME:"k4w_empty_library_store_name"},a,k,e;return{initialize:function(b,d){a=b;k=d;KindleUXComponentManager.initializeComponent("KindleLibraryMessagePane",g)},showEmptyLibraryMessage:function(){e||($("#page_body_content_containers").hide(),$(f.EMPTY_LIBRARY_MESSAGE).show(),e=!0)},hideEmptyLibraryMessage:function(){e&&($("#page_body_content_containers").show(),
$(f.EMPTY_LIBRARY_MESSAGE).hide(),e=!1)},showEmptySearchMessage:function(a){e||($("#page_body_content_containers").hide(),$(f.EMPTY_SEARCH_BOX).show(),$(f.EMPTY_SEARCH_TEXT).show(),a?$(f.EMPTY_SEARCH_DETAIL).show():$(f.EMPTY_SEARCH_DETAIL).hide(),e=!0)},hideEmptySearchMessage:function(){e&&($("#page_body_content_containers").show(),$(f.EMPTY_SEARCH_BOX).hide(),$(f.EMPTY_SEARCH_TEXT).hide(),$(f.EMPTY_SEARCH_DETAIL).hide(),e=!1)}}}(),KindleLibraryNoDownloadedMessage=function(){function g(e){a=e;var e=
a.find("."+b.TOGGLER_CLASS),g=a.find("."+b.IMG_ARROW_CLASS),d=a.find("."+b.CONTENT_TEXT_CLASS);e.tap(function(){d.slideToggle("fast");g.hasClass(f)?g.switchClass(f,j,0):g.switchClass(j,f,0)});k.resolve()}var f="kindleLibrary_arrowClosed",j="kindleLibrary_arrowOpen",b={TOGGLER_CLASS:"kindleLibrary_noDownloadedToggle",CONTENT_TEXT_CLASS:"kindleLibrary_noDownloadedContent",IMG_ARROW_CLASS:"kindleLibrary_noDownloadedArrow"},a,k;return{show:function(){k||(k=new jQuery.Deferred,KindleUXComponentManager.initializeComponent("KindleLibraryNoDownloadedMessage",
g));k.promise().then(function(){$("#kindleLibrary_noDownloadsMsg").length<=0&&$("#titles_container").append(a)})},hide:function(){k&&a.detach()}}}(),KindleLibraryProgressDialog=function(){function g(){KindleUXComponentManager.closeDialog(j);k()}function f(b){e&&b>=0&&b<=100&&e.find("#"+a.PROGRESS_DIV_ID).slider("option","value",b)}var j="KindleLibraryProgressDialog",b={DIALOG_CANCEL_BTN_ID:"k4w_common_cancel_button"},a={PROGRESS_DIV_ID:"kindleLibrary_progressbar_div"},k,e,n={getDialogSettings:function(){var a=
{};a[ResourceBundle.getLocalizedString(b.DIALOG_CANCEL_BTN_ID)]=g;return{autoOpen:!1,modal:!0,draggable:!1,resizable:!1,buttons:a,k4w_transparent_modal_overlay:!0}},beforeDialogOpen:function(){f(0)},onInitializationDone:function(b){e=b;e.find("#"+a.PROGRESS_DIV_ID).slider({range:"min",value:0,disabled:!0,max:100,min:0,step:1,animate:!0});e.find(".ui-slider-range").addClass("ui-corner-all")}};return{open:function(a){k=a;KindleUXComponentManager.openDialog(j,n)},close:function(){KindleUXComponentManager.closeDialog(j)},
updateValue:f}}(),KindleLibraryScrollBar=function(){function g(a){s=a;e(s.find("#"+q.UP_ARROW_ID),!0);e(s.find("#"+q.DOWN_ARROW_ID),!1);A&&l();O(s)}function f(a,c){F=B-c.value;y(F,!1)}function j(a,c){F=B-c.value;y(F,!0)}function b(a){F=a;s.find("#"+q.PROGRESS_ID).slider("option","value",B-a)}function a(a){a=F+a;a=Math.min(a,B);a=Math.max(a,0);b(a);y(a,!0)}function k(){s.find("#"+q.PROGRESS_ID).slider({orientation:"vertical",animate:!0,slide:f,stop:j});s.find("."+o).removeAttr("href");s.find("#"+q.SLIDER_CONTAINER_ID).tap(function(a){F=
a.clientY<a.currentTarget.offsetHeight/2?0:B;b(F);y(F,!0)});E=!0}function e(a,c){a.bind({mousedown:function(){n(c)},mouseup:d,mouseleave:d})}function n(b){d();var e=b?-m:m;a(e);P=0;v=setInterval(function(){P++;P>=c&&a(e)},p)}function d(){clearInterval(v)}function l(){E||k();var a=s.find("#"+q.SLIDER_CONTAINER_ID).height(),a=Math.max(a*x/A,h);s.find("#"+q.SLIDER_DIV_ID).css({top:a/2+"px",bottom:a/2+"px"});B=A-x;s.find("#"+q.PROGRESS_ID).slider("option","min",0).slider("option","max",B);b(F);s.find("."+
o).css({"margin-bottom":-a/2+"px",height:a+"px"})}var q={SLIDER_CONTAINER_ID:"KindleLibrarySliderContainer",SLIDER_DIV_ID:"KindleLibrarySliderDiv",PROGRESS_ID:"KindleLibraryProgress",UP_ARROW_ID:"kindleLibrarySliderUpArrow",DOWN_ARROW_ID:"kindleLibrarySliderDownArrow"},o="ui-slider-handle",m=80,p=100,c=5,h=20,O,y,s,E,v,P,A,F,x,B;return{initialize:function(a,c){O=a;y=c;KindleUXComponentManager.initializeComponent("KindleLibraryScrollBar",g)},updateValueRange:function(a,c,b){A=a;F=c;x=b;s&&l()},updateValue:function(a){F=
a;s&&b(a)},moveStart:n,moveEnd:d,movePage:function(c){a(c?-x:x)}}}(),KindleLibrarySettingsMenu=function(){function g(){a();KindleSigningOutDialog.show();KindleModuleManager.getModuleSync(KindleModuleManager.APP_REGISTRATION).deregister(null,!0).fail(function(){KindleSigningOutDialog.hide();KindleMessageDialog.open(ResourceBundle.getLocalizedString(e.OFFLINE_LOGOUT_TITLE),ResourceBundle.getLocalizedString(e.OFFLINE_LOGOUT_TEXT))})}function f(){a();KindleLibraryFeedbackDialog.show()}function j(){var a=
{};a[ResourceBundle.getLocalizedString(e.HELP_ID)]=b(n.HELP_LINK);a[ResourceBundle.getLocalizedString(e.TERM_OF_USE_ID)]=b(n.TERM_OF_USE_LINK);a[ResourceBundle.getLocalizedString(e.LEGAL_NOTICE_ID)]=b(n.LEGAL_NOTICE_LINK);a[ResourceBundle.getLocalizedString(e.CONTACT_US_ID)]=f;a[ResourceBundle.getLocalizedString(e.DEREGISTER_ID)]=g;return a}function b(b){return function(){a();d(b)}}function a(){KindleUXComponentManager.hideMenu(k)}var k="KindleLibrarySettingsMenu",e={HELP_ID:"k4w_library_help",TERM_OF_USE_ID:"k4w_library_terms_of_use",
LEGAL_NOTICE_ID:"k4w_library_legal_notices",DEREGISTER_ID:"k4w_library_deregister_title",CONTACT_US_ID:"k4w_library_contact_us",OFFLINE_LOGOUT_TITLE:"k4w_dialog_offlineLogout_Title",OFFLINE_LOGOUT_TEXT:"k4w_dialog_offlineLogout_Text"},n={HELP_LINK:"http://www.amazon.com/gp/help/customer/display.html/ref=kcr_help_menu?nodeId=200701430",TERM_OF_USE_LINK:"http://www.amazon.com/gp/help/customer/display.html/ref=kcr_terms_menu?nodeId=200506200",LEGAL_NOTICE_LINK:"http://www.amazon.com/gp/help/customer/display.html/ref=kcr_legalnotices_menu?nodeId=200701450"},
d;return{show:function(a){d=a;KindleUXComponentManager.showMenu(k,"kindleLibrary_button_manage",j(),"down")},hide:a}}(),KindleLibrarySortMenu=function(){function g(g){var b={};b[ResourceBundle.getLocalizedString(f.SORT_RECENT)]=function(){KindleLibrarySortMenu.hide();g("recent")};b[ResourceBundle.getLocalizedString(f.SORT_AUTHOR)]=function(){KindleLibrarySortMenu.hide();g("author")};b[ResourceBundle.getLocalizedString(f.SORT_TITLE)]=function(){KindleLibrarySortMenu.hide();g("title")};return b}var f=
{SORT_RECENT:"k4w_library_sort_recent",SORT_AUTHOR:"k4w_library_sort_author",SORT_TITLE:"k4w_library_sort_title"};return{show:function(f,b){KindleUXComponentManager.showMenu("KindleLibrarySortMenu","kindleLibrary_button_sort",g(b),f)},hide:function(){KindleUXComponentManager.hideMenu("KindleLibrarySortMenu")}}}(),KindleLibraryHomeScreenPopup=function(){function g(d){var g=$(document.createElement("span")).addClass(j.IMAGE_CLASS).context.outerHTML,n=$(document.createElement("span")).addClass(j.STRONG_TEXT_CLASS).text(ResourceBundle.getLocalizedString(b.STRONG_TEXT_ID)).context.outerHTML;
d.find("."+j.TEXT_CLASS).append(ResourceBundle.getLocalizedString(b.TEXT_ID,[g,n]));$("body").append(d);setTimeout(function(){d.addClass(f);d.tap(function(){KindleHostDeviceDetector.isiOS_5x()&&KindleLibraryHeaderBar.deactivateSearch();d.removeClass(f)});setTimeout(function(){d.removeClass(f)},k);setTimeout(function(){d.remove()},e)},a)}var f="shown",j={IMAGE_CLASS:"addToHomeActionIcon",TEXT_CLASS:"addToHomeText",STRONG_TEXT_CLASS:"addToHomeStrongText"},b={TEXT_ID:"k4w_addToHomeScreen_text",STRONG_TEXT_ID:"k4w_addToHomeScreen_strong_text"},
a=5E3,k=14E3,e=17E3,n;return{show:function(){!n&&KindleHostDeviceDetector.isiOS()&&!KindleHostDeviceDetector.isInAppMode()&&(n=!0,KindleUXComponentManager.initializeComponent("KindleLibraryHomeScreenPopup",g))}}}(),KindleIOSScrollStopper={stopScroll:function(g){g.preventDefault()}},KindleListUtilities=function(){return{binarySearch:function(g,f,j){if(!g.length)return 0;for(var b=g.length-1,a=0,k=0,e=null,n=0;a<=b;)if(k=Math.floor((a+b)/2),e=g[k],n=0,j===void 0?e>f?n=1:e<f&&(n=-1):n=j(f,e),n>0)b=k-
1;else if(n<0)a=k+1;else return k;return k===0||n<0?k:k-1},first:function(g){return g[0]},last:function(g){return g[g.length-1]}}}(),KindleOffline=function(){function g(b){var a=new jQuery.Deferred;setTimeout(a.resolve,b);return a.promise()}function f(b,a,f){if(b.indexOf(j)>=0&&KindleHostDeviceDetector.isiPad1()){var e=KindleModuleManager.getModuleSync(KindleModuleManager.METRICS_MANAGER),g=e.startMetrics("Reader::UnoptimizedBookOpen");KindleUnoptimizedFormatDialog.openPinning(function(b){b?(e.increaseSubCounter(g,
"Continue",1),e.endMetrics(g),e=null,a()):(e.increaseSubCounter(g,"Cancel",1),e.endMetrics(g),e=null,f())})}else a()}var j="topaz";return{isFirstTime:function(){return KindleLocalStorage.localStorageObject.getItem("haveRun")?!1:!0},isEnabled:function(){return KindleModuleManager.getModuleSync(KindleModuleManager.DB_CLIENT).bookDbEnabled()},firstRunMessage:function(){var b=new jQuery.Deferred;KindleFirstRunDialog.open(function(){KindleModuleManager.getModuleSync(KindleModuleManager.DB_CLIENT).enableFullDb().then(b.resolve,
b.reject);KindleLocalStorage.localStorageObject.setItem(Kindle.App.HAVE_RUN,"true")});return b.promise()},enableOfflineMessage:function(){var b=new jQuery.Deferred;KindleModuleManager.getModuleSync(KindleModuleManager.DB_CLIENT).enableFullDb().then(b.resolve,b.reject);setTimeout(function(){b.isRejected()&&KindleEnableOfflineDialog.open()},500);return b.promise()},pinBook:function(b,a){function k(){m.cancelDownloading();KindleLibraryProgressDialog.close();l.reject()}function e(){KindleLibraryProgressDialog.updateValue(100);
$.when(q,g(200)).then(function(){KindleLibraryProgressDialog.close();l.resolve()})}function j(c){KindleLibraryProgressDialog.close();c!==Kindle.ERROR.CANCELLED&&a(c);l.reject(c)}function d(){function a(c,b){KindleLibraryProgressDialog.updateValue(Math.round(100*Math.min(c,b)/Math.max(1,b)))}m.getSizeInfo().then(function(b){b.bookSize*1.53>b.quota?j(Kindle.ERROR.OUT_OF_SPACE):m.getBookType().then(function(b){f(b,function(){c.resolve(!0);m.getDownloadComplete(a).then(e,j)},function(){c.reject();k()})})})}
var l,q,o,m,p,c;l=new jQuery.Deferred;if(!KindleModuleManager.getModuleSync(KindleModuleManager.DB_CLIENT).bookDbEnabled())return l.reject(),l.promise();o=KindleModuleManagerFactory();window.parent.KindleApp.getSharedModules().done(function(a){o.registerModuleList(a);p=o.getModuleSync(o.METRICS_MANAGER).startMetrics("Pin");b.isSample=!1;m=KindleReaderBookInfoProvider.BookInfo(b,o);q=g(1500);c=new jQuery.Deferred;KindleLibraryProgressDialog.open(k);m.startDownloading(p,j,c).then(d,j)});return l.promise()},
unpinBook:function(b,a){function f(b){KindleSpinner.hide();q.endMetrics(o);a(b===Kindle.ERROR.NETWORK?Kindle.ERROR.REMOVE_NETWORK_FAILURE:Kindle.ERROR.REMOVE_FAILURE);d.reject(b)}function e(){KindleSpinner.hide();q.endMetrics(o);d.resolve()}function g(a){a.cacheState!==Kindle.BookInfo.CachedState.PINNED?a=!0:KindleHostDeviceDetector.isOnline()?(a={asin:b.asin,kindleSessionId:a.context.kindleSessionId,isOffline:!1},a=KindleModuleManager.getModuleSync(KindleModuleManager.SERVICE_CLIENT).setOfflineStatus(a)):
a=(new $.Deferred).reject(Kindle.ERROR.NETWORK).promise();return a}var d,j,q,o;KindleSpinner.show();d=new jQuery.Deferred;q=KindleModuleManager.getModuleSync(KindleModuleManager.METRICS_MANAGER);o=q.startMetrics("Unpin");j=KindleModuleManager.getModuleSync(KindleModuleManager.DB_CLIENT).getBookDb();j.getRecord("bookinfo",{asin:b.asin},{cacheState:!0,context:!0}).fail(f).done(function(a){a&&a.length>0&&$.when(g(a[0])).fail(f).done(function(){j.deleteBooksData([b.asin]).then(e,f)})});return d.promise()}}}(),
KindleTouchEventsToggler=function(){function g(a){if(b)for(var f=$(":hasTouchEvent"),e=0;e<f.length;e++){var g=f[e];if((!a||!a(g))&&g._listeners)for(var d=0;d<g._listeners.length;d++){var l=g._listeners[d][0];if(l==="touchstart"||l==="touchmove"||l==="touchend")l={element:g,type:l,func:g._listeners[d][1],useCapture:g._listeners[d][2]},j.push(l),g.removeEventListener(l.type,l.func,l.useCapture)}}}function f(){if(b){for(var a=0;a<j.length;a++){var f=j[a];f.element.addEventListener(f.type,f.func,f.useCapture)}j=
[]}}var j=[],b=!0;return{initialize:function(){var a=HTMLElement.prototype.addEventListener;HTMLElement.prototype.addEventListener=function(){if(!this._listeners)this._listeners=[];this._listeners.push(arguments);a.apply(this,arguments)};var b=HTMLElement.prototype.removeEventListener;HTMLElement.prototype.removeEventListener=function(){if(!this._listeners)this._listeners=[];var a=this._listeners.indexOf(arguments);a!==-1&&this._listeners.splice(a,1);b.apply(this,arguments)};$.expr[":"].hasTouchEvent=
function(a){if(a._listeners)for(var b=0;b<a._listeners.length;b++){var d=a._listeners[b][0];if(d==="touchstart"||d==="touchmove"||d==="touchend")return!0}return!1}},on:f,off:g,disallowTouchEvents:function(){b=!0;g();b=!1},allowTouchEvents:function(){b=!0;f()},isRequired:function(){return KindleHostDeviceDetector.isiOS()}}}();
(function(g){var f=["tap","tapHold","swipeLeft","swipeRight","activate"];g.each(f,function(f,b){g.fn[b]=function(a){return b==="tap"?KindleHostDeviceDetector.isiOS()?a?gt(this).on(b,a,{expire:700,moveThreshold:10}):this.trigger(b):a?this.click(a):this.trigger("click"):a?gt(this).on(b,a):this.trigger(b)};g.attrFn[b]=!0});g.each(f,function(f,b){var a="unbind"+b.slice(0,1).toUpperCase()+b.slice(1);g.fn[a]=function(a){return b==="tap"&&!KindleHostDeviceDetector.isiOS()?a?this.unbind("click",a):this.unbind("click"):
gt(this).off(b,a)};g.attrFn[a]=!0})})(jQuery);
var KindleUXComponentManager=function(){function g(a){if(a.callbacks.onDialogOpen)a.callbacks.onDialogOpen(a.component);a.callbacks.onOverlayClicked&&$(".ui-widget-overlay").tap(a.callbacks.onOverlayClicked).bind("contextmenu",function(b){a.callbacks.onOverlayClicked();b.preventDefault()})}function f(a,b,d){e(a,function(){var f;f=$.tmpl(a,ResourceBundle.getBundle(),d);l[a]={component:f};b(f)})}function j(a){a.stopPropagation()}function b(c,b,d,f){var e=l[c];e.callbacks=d;if(d.onInitializationDone)d.onInitializationDone(b);
if(d.getDialogSettings)e.dialogSettings=d.getDialogSettings();if(e.dialogSettings.width===void 0)e.dialogSettings.width=KindleHostDeviceDetector.isiPad()?o:m;e.dialogSettings.modal&&b.keydown(j).keyup(j);if(KindleHostDeviceDetector.isiOS_5x()){c=e.dialogSettings;if(c.modal)c.modal=!1,c.k4w_modal=!0;b=b.dialog(c)}else b=b.dialog(e.dialogSettings);e.component=b;if(!f&&!KindleHostDeviceDetector.isiOS_5x()){var k=b.dialog("option","position");$(window).resize(function(){b.dialog("option","position",k)})}b.bind("dialogopen",
function(){g(e)});b.bind("dialogclose",function(){if(e.callbacks.onDialogClose)e.callbacks.onDialogClose(e.component);e.dialogSettings.k4w_modal&&KindleDialogOverlay.removeOverlay()});b.bind("dialogbeforeclose",function(){$(".ui-widget-overlay").unbindTap();e.dialogSettings.modal&&p&&p(!0);e.callbacks.beforeDialogClose&&e.callbacks.beforeDialogClose(e.component)});a(e)}function a(a){a.component.dialog("isOpen")||(a.dialogSettings.k4w_transparent_modal_overlay?$("body").addClass(q):$("body").removeClass(q),
a.callbacks.beforeDialogOpen&&a.callbacks.beforeDialogOpen(a.component),a.dialogSettings.modal&&p&&p(!1),a.dialogSettings.k4w_modal&&KindleDialogOverlay.showOverlay(a),a.component.dialog("open"))}function k(a){l[a]&&l[a].component.dialog("isOpen")&&l[a].component.dialog("close")}function e(a,b){n(a).then(function(e){d[a]||($.template(a,e),b())},function(){KindleDebug.error("Template "+a+" is missing")})}function n(a){var b=$.Deferred(),a=$("#"+a);a.length!==1?b.reject():b.resolve(a);return b.promise()}
function d(a){return $.template[a]}var l=[],q="transparent_overlay",o=450,m=350,p;return{initializeTemplate:e,hasTemplate:d,renderTemplate:function(a,b){if(!$.template[a])throw{name:"initializationError",message:"Please call KindleUXComponentManager.initializeTemplate function first"};return $.tmpl(a,ResourceBundle.getBundle(),b)},initializeComponent:f,openDialog:function(c,d){var e=l[c];e?a(e):e!==null&&(l[c]=null,f(c,function(a){b(c,a,d)}))},closeDialog:k,isVisible:function(a){return l[a]&&l[a].component.dialog("isOpen")?
!0:!1},showMenu:function(c,d,e,f,g){var k=l[c];k?(d||KindlePopupMenu.updatePosition(c,f),g&&KindlePopupMenu.updateMenu(k.component,g),a(k)):KindlePopupMenu.initialize(c,d,e,f,function(a,d){g&&KindlePopupMenu.updateMenu(a,g);l[c]={component:a};b(c,a,d,!0)})},updateMenu:function(a,b){var d=l[a];d&&KindlePopupMenu.updateMenu(d.component,b)},hideMenu:k,registerKeyEventsEnabledCallback:function(a){p=a}}}(),ResourceBundle=function(){var g={en_US:{k4w_library_toolbar_store_button:"Kindle Store",k4w_library_toolbar_search_button:"Search",
k4w_library_toolbar_sync_button:"Sync",k4w_library_toolbar_manage_button:"Manage",k4w_library_toolbar_grid_button:"Grid View",k4w_library_toolbar_list_button:"List View",k4w_library_toolbar_sort_button:"Sort By",k4w_library_toolbar_cloud_button:"Cloud Content",k4w_library_toolbar_downloaded_button:"Downloaded Content",k4w_library_toolbar_cover_slider:"Cover Size",k4w_library_toolbar_cloud_label:"Cloud",k4w_library_toolbar_downloaded_label:"Downloaded",empty_search_msg:"No results for your search query.",
empty_search_offline:"(Only downloaded books are searchable when offline.)",k4w_reader_syncPosition_title:"Sync to Furthest Page Read",k4w_reader_syncPosition_labelText:'You are currently at location ${0}. The furthest read location is ${1} from "${2}" at ${3} on ${4}. Go to that location?',k4w_reader_syncPosition_noDeviceName_labelText:"You are currently at location ${0}. The furthest read location across all your devices is ${1}. Go to that location?",k4w_reader_syncPosition_OKText:"Sync",k4w_reader_syncPosition_cancelText:"Don't Sync",
k4w_reader_syncPosition_alreadyFurthest_Text:"You are currently at the furthest location across all your devices.",k4w_reader_syncPosition_cantSync_Text:"An error occurred while syncing. Please try again later.",k4w_reader_pageLoadError_Title:"Error Loading Content",k4w_reader_pageLoadError_Text:"An error occurred while loading the next page. Please try again later.",k4w_library_openBookContentLoanedError_Title:"Title Not Available",k4w_library_openBookContentLoanedError_Text:"This title cannot be opened because it is currently on loan.",
k4w_library_openBookContentLoanEndedError_Title:"Title Not Available",k4w_library_openBookContentLoanEndedError_Text:"This book was loaned to you and cannot be opened because the loan has ended.",k4w_library_openBookContentRentalExpiredError_Title:"Rental Expired",k4w_library_openBookContentRentalExpiredError_Text:"This rented book has reached its expiration date. Please select the Extend or Purchase button below if you would like to rent again or purchase this book.",kindle_dialog_rental_expired_extend_button_text:"Extend or Purchase",
kindle_dialog_rental_expired_dismiss_button_text:"Dismiss",k4w_library_openBookContentLicenseExceededError_Title:"License Limit Reached",k4w_library_openBookContentLicenseExceededError_Text:"You have exceeded the limit on the number of devices that can read this item. You may deregister any device no longer in use and delete the content, which will allow you to download this item. You may also purchase another copy from the Kindle Store.",k4w_library_openBookTimeoutError_Title:"Network Connection Error",
k4w_library_openBookTimeoutError_Text:"A connection error occurred. Please try again later.",k4w_library_openBookNetworkError_Title:"Error Opening Content",k4w_library_openBookNetworkError_Text:"An error occurred while opening the selected item. Please try again later.",k4w_library_openBookContentUnsupportedError_Title:"Title Not Available",k4w_library_openBookContentUnsupportedError_Text:"This title is not available on Kindle Cloud Reader.",k4w_library_openBookLoadFailure_Title:"Error Opening Content",
k4w_library_openBookLoadFailure_Text:"An error occurred while opening the selected item. Please try again later.",k4w_library_openBookSessionLimitExceededError_Title:"Session Limit Reached",k4w_library_openBookSessionLimitExceededError_Text:"You have reached the maximum number of concurrent sessions allowed for this title. Please try again later.",k4w_library_syncFailedError_Title:"Sync Failed",k4w_library_syncFailedError_Text:"An error occurred while syncing. Please try again later.",k4w_library_syncFailedOfflineError_Title:"Sync Failed",
k4w_library_syncFailedOfflineError_Text:"A connection to the Internet is required to view your content in the Cloud.",k4w_library_saveBookOutOfSpace_Title:"Error Saving Content",k4w_library_saveBookOutOfSpace_Text:"There is not enough space to save this item for offline reading. You may continue to read this title while online. Space can be freed by removing other saved titles. You might be able to increase your offline storage space; for more information <a href='http://www.amazon.com/gp/help/customer/display.html/ref=kcr_help_menu?nodeId=200732370#fxoffline' target='_blank'>click here</a>.",
k4w_library_removeBookError_Title:"Error Removing Content",k4w_library_removeBookError_Text:'An error occurred while removing the selected item. Downloaded content can be erased from this computer by choosing "Sign Out" from the Settings menu.',k4w_library_removeBookNetworkError_Title:"Error Removing Content",k4w_library_removeBookNetworkError_Text:"An error occurred while removing the selected item. Please try again later.",k4w_library_storeNotAvailable_Title:"No Internet Connection",k4w_library_storeNotAvailable_Text:"A connection to the Internet is required to shop in the Kindle Store.",
k4w_library_bookNotAvailable_Title:"No Internet Connection",k4w_library_bookNotAvailable_Text:"A connection to the Internet is required to view your content in the Cloud.",k4w_library_loadFailedError_Title:"Error Loading Library",k4w_library_loadFailedError_Text:"An error occurred while trying to load the library.",k4w_bookextras_open_failed_Error_Title:"Unable to Open Book Extras",k4w_bookextras_open_failed_Error_Text:"Book Extras for this book is not available at this time.",k4w_bookextras_offline_cache_failed_Error_Title:"Unable to Open Book Extras",
k4w_bookextras_offline_cache_failed_Error_Text:"Book Extras for this book was not saved for offline use.",k4w_store_open_failed_Error_Title:"Unable to Open Kindle Store",k4w_store_open_failed_Error_Text:"An error occurred while opening the Kindle Store. Please try again later.",k4w_store_open_failed_offline_Error_Title:"Unable to Open Kindle Store",k4w_store_open_failed_offline_Error_Text:"A connection to the Internet is required to access the Kindle Store.",k4w_library_unimplementedFeature_Error_Text:"",
k4w_dialog_offlineLogout_Title:"No Internet Connection",k4w_dialog_offlineLogout_Text:"A connection to the Internet is required to sign out of Kindle Cloud Reader.",k4w_library_unknownError_Title:"Error Opening Content",k4w_library_unknownError_Text:"An error occurred while attempting to open the selected item. Please try again later.",k4w_notification_title_text:"Create, edit, and delete notes and highlights in Cloud Reader.",k4w_notification_preTitle_text:"New!",k4w_notification_body_text:"Select text within a book to create a new note or highlight. Click the icon above to see all your notes and highlights.",
k4w_library_configurationRequest_Text:"",k4w_library_offlineRequest_Text:"",k4w_library_firstRun_Text:"",k4w_addToHomeScreen_text:"Install Kindle Cloud Reader on your iPad: tap ${0} then ${1}",k4w_addToHomeScreen_strong_text:"Add to Home Screen",k4w_notification_strong_text:"Create, edit and delete notes & highlights from Cloud Reader!",k4w_notification_blue_text:"New!",k4w_notification_text:"Select text within a book to create a new note or highlight. Click the icon above to see all your notes and highlights.",
k4w_endOfSample_Title:"End of Sample Content",k4w_endOfSample_Text:"You have reached the end of the sample content.  You can buy the full version from the Kindle Store or return to your sample.",k4w_endOfSample_buy_button:"Buy Full Version",k4w_endOfSample_cancel_button:"Return to Sample",k4w_library_sort_recent:"Sort by Recent",k4w_library_sort_author:"Sort by Author",k4w_library_sort_title:"Sort by Title",k4w_library_sort_recent_label:"Recent",k4w_library_sort_author_label:"Author",k4w_library_sort_title_label:"Title",
k4w_library_context_pin:"Pin Book",k4w_library_context_remove:"Remove Book",k4w_library_context_read:"Open Book",k4w_library_context_download_pin:"Download & Pin Book",k4w_library_deregister_title:"Sign Out",k4w_dialog_message_dismissButton_text:"OK",k4w_dialog_message_retryButton_text:"Try Again",k4w_reader_cover_title:"Cover",k4w_reader_table_of_contents_title:"Table of Contents",k4w_reader_beginning_title:"Beginning",k4w_reader_goto_location_title:"Location...",k4w_reader_book_extras_title:"Book Extras",
k4w_reader_slider_location_popup:"Location ${0} of ${1}",k4w_reader_slider_location:"${0} of ${1}",k4w_reader_slider_percentage:"Location: ${0}%",k4w_reader_downloading:"Downloading: ${0}%",k4w_reader_downloaded:"Downloaded ${0}%",k4w_reader_download_disk_error:"Downloaded: ${0}(Disk Full)",k4w_reader_download_network_error:"Download Stalled: ${0}(Error)",k4w_reader_goto_menu_goto_location_title:"Location...",k4w_reader_goto_menu_goto_message:"Please enter a location: ",k4w_reader_goto_menu_goto_location:"[from ${0} to ${1}]",
k4w_reader_goto_menu_goto_button:"Go to location",k4w_common_confirm_button:"OK",k4w_common_cancel_button:"Cancel",k4w_common_close_button:"Close",k4w_reader_toolbar_library_button:"Library",k4w_reader_toolbar_iOS_sample_close_button:"Close",k4w_reader_settings_sampleText:"Emma Woodhouse, handsome, clever, and rich, with a comfortable home and happy disposition, seemed to unite some of the best blessings of existence; and had lived nearly twenty-one years in the world with very little to distress or vex her.",
k4w_reader_settings_apply_button:"Apply Settings",k4w_reader_settings_fontSize_label:"FONT SIZE",k4w_reader_settings_margins_label:"MARGINS",k4w_reader_settings_colorMode_label:"COLOR MODE",k4w_reader_settings_pageview_label:"PAGE MODE",k4w_reader_sidebar_notes_location:"Location ${0}",k4w_reader_sidebar_bookmark_label:"Bookmark",k4w_reader_sidebar_note_label:"Note",k4w_reader_sidebar_note_highlight:"Highlight",k4w_reader_sidebar_delete:"Delete",k4w_reader_sidebar_empty_note:"This book does not contain any notes or marks.",
k4w_reader_annotation_pane_delete:"Delete",k4w_reader_annotation_pane_edit:"Edit Note",k4w_reader_annotation_pane_goto:"Go To Location",k4w_reader_annotation_pane_cancel:"Cancel",k4w_reader_annotation_pane_save:"Save Note",k4w_reader_annotation_pane_delete_confirm:"Confirm delete?",k4w_reader_annotation_pane_next:"Click for next",k4w_reader_annotation_pane_previous:"Click for previous",k4w_library_progress_dialog_title:"Downloading & Pinning Book",k4w_library_progress_dialog_message:"This title will be saved in the Downloaded tab for offline reading until you remove it. For convenience, we also automatically download recently opened books and keep them until space is needed.",
kindle_dialog_firstRun_offline_title:"Set Up Kindle Cloud Reader for Offline Reading",kindle_dialog_firstRun_chrome_app_title:"Kindle Cloud Reader Works Offline Too",kindle_dialog_firstRun_chrome_app_msg:"<strong>Right-click</strong> on any book cover then select <strong>&#8220;Download & Pin Book&#8221;</strong> to save a book for reading offline. We also store your most recently read books in the Downloaded section of your Library.",kindle_dialog_firstRun_chrome_msg:"Click <strong>&#8220;Enable Offline&#8221;</strong> below and then click <strong>&#8220;Continue&#8221;</strong> at the bottom of your browser window to enable offline reading.",
kindle_dialog_firstRun_ios_prompt_msg:"Tap <strong>&#8220;Increase&#8221;</strong> when prompted.  Then <strong>press and hold</strong> on any book cover in your Library and select <strong>&#8220;Download & Pin Book&#8221;</strong> to save a book for reading offline. We also store your most recently read books in the Downloaded section of your Library.",kindle_dialog_firstRun_safari_prompt_msg:"Click <strong>&#8220;Allow&#8221;</strong> when prompted.  Then <strong>click and hold</strong> on any book cover in your Library and select <strong>&#8220;Download & Pin Book&#8221;</strong> to save a book for reading offline. We also store your most recently read books in the Downloaded section of your Library.",
kindle_dialog_firstRun_firefox_msg:"Click the <strong>&#8220;Allow&#8221;</strong> button twice: once in the popup and once in the bar at the top of your browser window. ",kindle_noDownloadedBooks_title:"You currently have no downloaded books.",kindle_noDownloadedBooks_showmore:"How do I download books?",kindle_noDownloadedBooks_msg:"Your most recently read books are downloaded and displayed here. We automatically remove older books to make room for newer ones. You can also right-click (desktop) or press-and-hold (iPad) on any book cover to &#8220;Download & Pin Book.&#8221; Pinned books are available for offline reading until you remove them.",
k4w_empty_library_title:"You currently have no books in your Kindle Library",k4w_empty_library_main:"Shop from over 950,000* books in the ${0}.",k4w_empty_library_store_name:"Kindle Store",k4w_empty_library_free:"(Thousands of free books too!)",k4w_empty_library_legal:"*Book availability may vary for non-U.S. customers.",kindle_dialog_firstRun_button_text:"Get Started Now",kindle_dialog_firstRun_button_text_chrome:"Not Now",kindle_dialog_firstRun_button_text_chrome_done:"Continue",kindle_dialog_firstRun_button_crx_text:"Enable Offline",
kindle_dialog_firstRun_button_installing_text:"Click Continue Below...",kindle_dialog_firstRun_button_installed_text:"Install Complete",kindle_dialog_enableOffline_button_text:"OK",kindle_dialog_enable_offline_title:"Enable Offline Reading",kindle_dialog_enable_offline_firefox_msg:"Kindle Cloud Reader requires your permission to store books for offline reading. If you selected \u201cNever for This Site\u201d when Firefox asked for permission, you will need to <a href='http://www.amazon.com/gp/help/customer/display.html/ref=kcr_help_menu?nodeId=200732370#fxoffline' target='_blank'>follow these steps</a> to enable offline reading in Firefox.",
k4w_reader_menuButton_back:"Back",k4w_reader_menuButton_goto:"Go to menu",k4w_reader_menuButton_controlPane:"View settings",k4w_reader_menuButton_bookmark:"Toggle bookmark",k4w_reader_menuButton_sync:"Synchronize",k4w_reader_menuButton_notesAndMarks:"Toggle notes and marks",k4w_reader_menuButton_enterImmersive:"Enter immersive reading mode",k4w_reader_menuButton_exitImmersive:"Exit immersive reading mode",k4w_reader_pageArrow_prev:"Previous Page",k4w_reader_pageArrow_next:"Next Page",k4w_reader_storeNotAvailable_message:"No Internet Connection.<br /> A connection to the Internet is required to shop in the Kindle Store.",
k4w_reader_bookNotAvailable_message:"No Internet Connection.<br /> A connection to the Internet is required to view your content in the Cloud.",k4w_reader_context_createHighlight:"Highlight",k4w_reader_context_createNote:"Note",k4w_reader_context_editNote:"Note",k4w_reader_context_deleteHighlight:"Delete",k4w_library_help:"Help",k4w_library_terms_of_use:"Terms of Use",k4w_library_legal_notices:"Legal Notices",k4w_library_contact_us:"Contact Us",k4w_send_feedback_button:"Send",k4w_provide_feedback_title:"Contact Us",
k4w_provide_feedback_text:"Please enter your question or feedback in the space below.",k4w_provide_feedback_error:"An error occurred while attempting to send this message. Please try again later.",k4w_provide_feedback_sending:"Sending...",k4w_provide_feedback_success:"Message successfully sent! &#x2713;",k4w_reader_dialog_unoptimizedFormat_title:"Unsupported Content",k4w_reader_dialog_unoptimizedFormat_message:"This book is not optimized for Kindle Cloud Reader on this device. Please install <a href='http://itunes.apple.com/us/app/kindle/id302584613?mt=8'>Kindle for iPad</a> to read this item.",
k4w_reader_dialog_unoptimizedFormat_close:"Close Book",k4w_reader_dialog_unoptimizedFormat_stopSave:"Cancel Save",k4w_reader_dialog_unoptimizedFormat_continue:"Continue Anyway",k4w_library_caching:"Saving app for offline use",k4w_library_cached:"&#x2713; App ready for offline use",k4w_library_cacheError:"Error saving app. Click here to try again.",k4w_library_cacheError_pad:"Error saving app. Tap here to try again.",k4w_reader_dialog_annotation_pane_title:"Notes & Marks",kindle_dialog_appCache_title_text:"Error Saving Application",
kindle_dialog_appCache_button_text:"OK",kindle_dialog_appCache_message_text:"We encountered an error while trying to save the application for offline reading. To fix this you will need to restart the Safari application and any other running instances of Kindle Cloud Reader.",kindle_dialog_appCache_readmore_text:"How do I restart Safari and/or Kindle Cloud Reader?",kindle_dialog_appCache_step1_text:"Step 1.",kindle_dialog_appCache_step2_text:"Step 2.",kindle_dialog_appCache_step3_text:"Step 3.",kindle_dialog_appCache_step4_text:"Step 4.",
kindle_dialog_appCache_step5_text:"Step 5.",kindle_dialog_appCache_instruction1_text:"Click the iPad Home button to exit this application.",kindle_dialog_appCache_instruction2_text:"Click the iPad Home button twice to show the running applications tray (located at the bottom of your iPad's screen).",kindle_dialog_appCache_instruction3_text:"Locate the Safari application icon and press-and-hold on the icon until a minus button appears in the top left corner. Tap the minus button.",kindle_dialog_appCache_instruction4_text:"Locate any other instances of Kindle Cloud Reader and press-and-hold its icon until a minus button appears in the top left corner. Tap the minus button.",
kindle_dialog_appCache_instruction5_text:"Restart Safari and try loading read.amazon.com again.",kindle_dialog_logout_title:"Signing out of Kindle Cloud Reader...",kindle_dialog_logout_message:"Please wait while we clean up your downloaded content.",k4w_reader_dialog_editNote_title_create:"Create Note",k4w_reader_dialog_editNote_title_edit:"Edit Note",k4w_reader_dialog_editNote_save:"Save",k4w_reader_dialog_editNote_delete:"Delete",k4w_reader_dialog_editNote_cancel:"Cancel",k4w_reader_dialog_editNote_placeholder:"Type your note here"}},
f={en_US:"hh:mm a"},j={en_US:"MMM dd, yyyy"},b={en_US:"hh:mm a MMM dd, yyyy"},a="en_US";return{setLocale:function(b){a=b},getBundle:function(b){return g[b?b:a]},getLocalizedString:function(b,e,f){f=f?f:a;b=g[f]?g[f][b]:void 0;return e?String.prototype.format.apply(b,e):b||""},getLocalizedTime:function(b){return $.format.date(b,f[a])},getLocalizedDate:function(b){return $.format.date(b,j[a])},getLocalizedDateTime:function(f){return $.format.date(f,b[a])}}}();
